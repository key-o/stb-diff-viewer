<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XML Viewer – In‑Editor XPath Generator</title>

    <!-- 外部CSSファイルを読み込み -->
    <link rel="stylesheet" href="./styles/xpath-viewer.css" />

    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/loader.js"></script>

    <!-- 外部JavaScriptファイルを読み込み -->
    <script src="./scripts/xpath-viewer.js"></script>
  </head>
  <body>
    <div id="sidebar">
      <header>XML Viewer</header>

      <div class="input-group">
        <label class="info-label">ファイル読み込み</label>
        <input
          type="file"
          accept=".xml,.stb,.svf"
          oninput="loadXml(this.files[0])"
        />
      </div>

      <div class="input-group">
        <header>XPath (カーソル位置)</header>
        <div class="tooltip">
          <input
            id="xpathCurrent"
            readonly
            placeholder="カーソルを XML 要素/属性上へ置くと表示"
            onclick="copyField('xpathCurrent')"
          />
        </div>
        <div class="button-group">
          <button class="primary" onclick="setBase()">起点として設定</button>
          <button id="namespaceToggle" onclick="toggleNamespace()">
            名前空間なし
          </button>
        </div>
      </div>

      <div class="input-group">
        <label class="info-label">起点 XPath</label>
        <div class="tooltip">
          <input
            id="baseXPath"
            readonly
            placeholder="起点となるXPath"
            onclick="copyField('baseXPath')"
          />
        </div>
      </div>

      <div class="input-group">
        <label class="info-label">相対 XPath</label>
        <div class="tooltip">
          <input
            id="relXPath"
            readonly
            placeholder="起点からの相対パス"
            onclick="copyField('relXPath')"
          />
        </div>
      </div>

      <div class="input-group">
        <label class="info-label">XPath 検索</label>
        <div class="tooltip">
          <input
            type="text"
            id="xpathSearch"
            placeholder="例: //StbNode[@id='1'] または //stb:StbColumn"
            style="flex: 1"
          />
        </div>
        <div class="button-group" style="margin-bottom: 4px">
          <button class="primary" onclick="searchXPath()">検索</button>
          <!-- 前後ボタンに primary クラスを追加して水色に -->
          <button data-action="prev" class="primary" title="前の結果" disabled>
            &lt;
          </button>
          <button data-action="next" class="primary" title="次の結果" disabled>
            &gt;
          </button>
          <span
            id="searchStatus"
            style="display: none; margin-left: 8px"
          ></span>
        </div>
        <!-- デバッグ情報表示用のエリア追加 -->
        <div
          class="debug-info"
          id="xpathDebug"
          style="
            display: none;
            margin-top: 4px;
            font-size: 0.85em;
            font-family: monospace;
          "
        ></div>
      </div>

      <!-- 検索のヒント情報 -->
      <div class="info-badge">
        <p><strong>検索精度向上のヒント:</strong></p>
        <ul>
          <li>ID属性による検索で完全一致: <code>//StbNode[@id="1"]</code></li>
          <li>
            複数の属性で絞り込み: <code>//StbColumn[@id="1"][@name="C1"]</code>
          </li>
          <li>
            階層を指定して絞り込み:
            <code>//StbModel/StbNodes/StbNode[@id="1"]</code>
          </li>
        </ul>
      </div>

      <!-- 情報バッジを追加 -->
      <div class="info-badge">
        <p>ST-Bridge XML検索のヒント:</p>
        <ul>
          <li>要素名だけの検索: <code>//StbNode</code></li>
          <li>ID属性による検索: <code>//StbNode[@id="1"]</code></li>
          <li>
            XPath構文に不安がある場合は開発者ツールのコンソールを確認してください
          </li>
        </ul>
      </div>

      <div class="input-group">
        <div class="info-badge">
          ST-Bridge
          XML形式では、名前空間プレフィックスの有無は自動的に処理されます。 例:
          <code>//StbNode</code> と
          <code>//stb:StbNode</code> は両方使用可能です。
        </div>
      </div>
    </div>
    <!-- リサイズハンドルを追加 -->
    <div id="resizer" title="ドラッグしてパネルサイズを変更"></div>
    <div id="main">
      <div id="editor"></div>
      <div class="status-bar">
        <div id="cursorPosition">行: 1, 列: 1</div>
        <div id="statusMessage" class="status-message"></div>
        <div id="fileInfo"></div>
      </div>
    </div>
  </body>
</html>
