# STB Diff Viewer v2.1

## 概要

STB Diff Viewer は、STB および XML 形式で保存された 3D モデルを比較するために設計された Web アプリケーションです。2 つのモデル間の違いと類似点を視覚化し、モデル比較のためのユーザーフレンドリーなインターフェースを提供します。

### バージョン2.1の新機能

- **🚀 クラウドAPI対応**: Google Cloud Run上のAPIサーバーでIFC変換が可能
- **⚡ ローカルサーバー不要**: インターネット接続のみでIFC変換機能を利用可能
- **🔗 統合されたワークフロー**: STB比較からIFC出力まで一元化

### バージョン2.0の機能

- **統合ラベル管理システム**: 後方互換性レイヤーを削除し、パフォーマンスを向上
- **モジュラー設計の最適化**: 非推奨コンポーネントを削除してコードベースを簡素化
- **向上したメンテナンス性**: より清潔で管理しやすいアーキテクチャ

## IFC変換機能（新機能）

STB Diff ViewerからSTBファイルを直接IFCファイルに変換できます。

- **APIエンドポイント**: `https://stb2ifc-api-e23mdd6kwq-an.a.run.app/`
- **最大ファイルサイズ**: 64MB
- **対応形式**: STB (XML), XML → IFC
- **処理時間**: 数秒～数分（ファイルサイズに依存）

### 使用方法

1. STBファイルを読み込み
2. 画面下部の「🏗️ IFCファイルに変換」ボタンをクリック
3. 変換完了後、IFCファイルが自動ダウンロード

## プロジェクト構成

```
javascr/
├── js/
│   ├── main.js              # アプリケーションのエントリーポイント
│   ├── ui.js                # UI操作と表示の管理
│   ├── comparator.js        # モデル比較ロジック
│   ├── parser/              # STB/XMLデータのパース機能
│   │   ├── stbXmlParser.js      # 基本XMLパース処理
│   │   └── stbStructureReader.js# 構造データの詳細抽出
│   └── viewer/              # 3Dビューア機能 (Three.js)
│       ├── index.js         # ビューアモジュールのエクスポート
│       ├── core.js          # シーン、カメラなどのコア機能
│       ├── elements.js      # 構造要素の描画処理
│       ├── labels.js        # 3D空間内のラベル管理
│       ├── layout.js        # 通り芯・階の表示機能
│       ├── materials.js     # マテリアル定義
│       ├── utils.js         # ビューア用ユーティリティ関数
│       ├── geometryGenerator.js # 3Dジオメトリ生成
│       └── elementInfoDisplay.js# 要素情報の表示
├── index.html               # メインHTMLファイル
├── style.css                # スタイルシート
└── README.md                # プロジェクト説明書
```

## セットアップ手順

1. **リポジトリのクローン**

    ```bash
    git clone <repository-url>
    cd javascr
    ```

2. **プロジェクトを開く**
    Web ブラウザで `index.html` を開いてアプリケーションを実行します。

3. **ファイルアップロード**
    ファイル入力フィールドを使用して、比較する 2 つのモデル (STB または XML 形式) をアップロードします。

## 利用ガイドライン

- チェックボックスを使用して比較したい要素を選択します。
- 「モデルを表示/比較」ボタンを使用して比較を開始します。
- 提供されているドロップダウンとボタンを使用して、階クリッピングや軸クリッピングを調整します。
- 凡例パネルを切り替えて、モデルの違いの色分けを表示します。

## 開発ドキュメント

### アーカイブファイル

実装が完了した機能の設計書・計画書は `archive/completed-implementations/` に保存されています。

- **重要度統合機能**: 差分表示に重要度設定を反映する機能
- **パラメータサジェスト機能**: XSDスキーマベースの入力支援機能

詳細については [archive/completed-implementations/INDEX.md](archive/completed-implementations/INDEX.md) をご参照ください。

### 現在のプロジェクト状況

最新の実装状況や開発中の機能については、GitHubのIssuesとPull Requestsをご確認ください。

## コントリビューション

貢献を歓迎します！機能強化やバグ修正については、プルリクエストを送信するか、Issue をオープンしてください。

実装計画書は `archive/` ディレクトリ内のファイルを参考にしてください。

## ライセンス

このプロジェクトは MIT ライセンスの下でライセンスされています。詳細については、LICENSE ファイルを参照してください。
