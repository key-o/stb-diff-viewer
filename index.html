<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>STB Diff Viewer</title>
    <link rel="stylesheet" href="./style/style.css" />
    <!-- â˜…â˜…â˜… è¿½åŠ : è¦ç´ æƒ…å ±ãƒ‘ãƒãƒ«ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… -->
    <style>
      #component-info {
        position: absolute; /* çµ¶å¯¾ä½ç½®æŒ‡å®š */
        top: 10px; /* ä¸Šã‹ã‚‰ã®è·é›¢ */
        left: 10px; /* å·¦ã‹ã‚‰ã®è·é›¢ */
        background-color: rgba(240, 240, 240, 0.85); /* åŠé€æ˜ã®èƒŒæ™¯ */
        border: 1px solid #ccc;
        padding: 10px;
        min-width: 300px; /* æœ€å°å¹…ã‚’å¤§ããè¨­å®š */
        min-height: 100px; /* æœ€å°é«˜ã•ã‚’è¿½åŠ  */
        width: 30vw; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¹…ã‚’å¤§ããè¨­å®š */
        max-width: 70vw; /* æœ€å¤§å¹…ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆåŸºæº–ã« */
        max-height: 80vh; /* æœ€å¤§é«˜ã•ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆåŸºæº–ã« */
        overflow: auto; /* å†…å®¹ãŒå¤šã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« (overflow-y ã‹ã‚‰å¤‰æ›´) */
        resize: both; /* â˜…â˜…â˜… è¿½åŠ : ãƒªã‚µã‚¤ã‚ºå¯èƒ½ã«ã™ã‚‹ â˜…â˜…â˜… */
        z-index: 10; /* ä»–ã®è¦ç´ ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤º */
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        font-size: 0.9em;
        color: #333;
      }
      #component-info h3 {
        margin-top: 0;
        margin-bottom: 8px;
        font-size: 1.1em;
        color: #111;
      }
      #component-info pre {
        margin: 0;
        white-space: pre-wrap; /* æŠ˜ã‚Šè¿”ã—è¡¨ç¤º */
        word-wrap: break-word;
      }
      #element-info-content {
        margin-top: 0;
      }
      /* â˜…â˜…â˜… è¿½åŠ : å‡¡ä¾‹ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      #legendPanel {
        position: fixed; /* ç”»é¢ã«å¯¾ã—ã¦å›ºå®š */
        bottom: 10px; /* ç”»é¢ä¸‹ã‹ã‚‰ã®è·é›¢ */
        left: 10px; /* ç”»é¢å·¦ã‹ã‚‰ã®è·é›¢ */
        background-color: rgba(
          240,
          240,
          240,
          0.85
        ); /* èƒŒæ™¯è‰² (component-infoã¨åˆã‚ã›ã‚‹) */
        border: 1px solid #ccc; /* å¢ƒç•Œç·š (component-infoã¨åˆã‚ã›ã‚‹) */
        padding: 10px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° (component-infoã¨åˆã‚ã›ã‚‹) */
        min-width: 150px; /* æœ€å°å¹… */
        max-width: 300px; /* æœ€å¤§å¹…ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆåŸºæº–ã« */
        z-index: 10; /* é‡ãªã‚Šé †åº (component-infoã¨åŒã˜) */
        border-radius: 4px; /* è§’ä¸¸ (component-infoã¨åˆã‚ã›ã‚‹) */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* å½± (component-infoã¨åˆã‚ã›ã‚‹) */
        /* display: none; ã¯HTMLè¦ç´ ã®styleå±æ€§ã§åˆ¶å¾¡ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯ä¸è¦ */
      }
      /* â˜…â˜…â˜… ã“ã“ã¾ã§è¿½åŠ  â˜…â˜…â˜… */

      /* â˜…â˜…â˜… ç·¨é›†æ©Ÿèƒ½ç”¨ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      .btn {
        padding: 4px 8px;
        margin: 2px;
        border: 1px solid #ccc;
        border-radius: 3px;
        background-color: #f8f9fa;
        cursor: pointer;
        font-size: 0.8em;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
      }
      .btn-warning {
        background-color: #ffc107;
        color: #212529;
        border-color: #ffc107;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
        border-color: #28a745;
      }
      .btn-danger {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
      }
      .btn-sm {
        padding: 2px 6px;
        font-size: 0.7em;
      }
      .edit-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.8em;
        margin-left: 5px;
        padding: 1px 3px;
        border-radius: 2px;
        opacity: 0.7;
      }
      .edit-btn:hover {
        opacity: 1;
        background-color: #e9ecef;
      }
      #editing-controls {
        background-color: #f8f9fa;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        margin-bottom: 10px;
      }
      /* â˜…â˜…â˜… ç·¨é›†æ©Ÿèƒ½ç”¨ã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… è‰²åˆ†ã‘UIç”¨ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      #color-mode-controls {
        background-color: #f8f9fa;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }
      .form-control {
        width: 100%;
        padding: 4px 8px;
        border: 1px solid #ced4da;
        border-radius: 3px;
        font-size: 0.9em;
      }
      .color-legend-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
      }
      .legend-item {
        display: flex;
        align-items: center;
        font-size: 0.75em;
      }
      .legend-color-box {
        width: 12px;
        height: 12px;
        border: 1px solid #ccc;
        margin-right: 4px;
        display: inline-block;
      }
      .legend-label {
        white-space: nowrap;
      }
      /* è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰ç”¨è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
      .element-color-settings {
        display: none;
        margin-top: 10px;
      }
      .schema-color-settings {
        display: none;
        margin-top: 10px;
      }
      .color-setting-label {
        font-size: 0.9em;
      }
      .margin-left-8 {
        margin-left: 8px;
      }
      .legend-panel-hidden {
        display: none;
      }
      .legend-color-matched {
        background-color: #00aaff;
      }
      .legend-color-onlya {
        background-color: #00ff00;
      }
      .legend-color-onlyb {
        background-color: #ff0000;
      }
      .editing-summary {
        margin-top: 8px;
        font-size: 0.9em;
      }
      .legend-color {
        width: 12px;
        height: 12px;
        border: 1px solid #ccc;
        margin-right: 4px;
        display: inline-block;
      }
      /* â˜…â˜…â˜… è‰²åˆ†ã‘UIç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã“ã“ã¾ã§ â˜…â˜…â˜… */
    </style>
  </head>
  <body>
    <div id="overlay">
      <label for="fileA">ãƒ¢ãƒ‡ãƒ«A</label>
      <input type="file" id="fileA" accept=".stb,.xml" />
      <label for="fileB">ãƒ¢ãƒ‡ãƒ«B</label>
      <input type="file" id="fileB" accept=".stb,.xml" />
      <!-- â˜…â˜…â˜… ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–° â˜…â˜…â˜… -->
      <button id="compareButton">ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ãƒ»è¡¨ç¤º</button>

      <hr />

      <!-- â˜…â˜…â˜… è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰é¸æŠUI â˜…â˜…â˜… -->
      <div id="color-mode-controls">
        <label><strong>è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰</strong></label
        ><br />
        <select
          id="colorModeSelector"
          class="form-control"
          title="è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ"
        >
          <option value="diff">å·®åˆ†è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</option>
          <option value="element">éƒ¨æåˆ¥è‰²ä»˜ã‘</option>
          <option value="schema">ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è¡¨ç¤º</option>
        </select>

        <!-- éƒ¨æåˆ¥è‰²ä»˜ã‘è¨­å®š -->
        <div id="element-color-settings" class="element-color-settings">
          <label class="color-setting-label"
            ><strong>éƒ¨æè‰²è¨­å®š:</strong></label
          >
          <div class="color-legend-container" id="element-color-controls">
            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
          </div>
        </div>

        <!-- ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è‰²è¨­å®š -->
        <div id="schema-color-settings" class="schema-color-settings">
          <label class="color-setting-label"
            ><strong>ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è‰²è¨­å®š:</strong></label
          >
          <div class="color-legend-container">
            <div class="legend-item">
              <input
                type="color"
                id="schema-valid-color"
                value="#00aaff"
                class="legend-color-box"
              />
              <span class="legend-label">æ­£å¸¸è¦ç´ </span>
            </div>
            <div class="legend-item">
              <input
                type="color"
                id="schema-error-color"
                value="#ff0000"
                class="legend-color-box"
              />
              <span class="legend-label">ã‚¨ãƒ©ãƒ¼è¦ç´ </span>
            </div>
          </div>
        </div>
      </div>

      <hr />

      <label>æ¯”è¼ƒ/è¡¨ç¤ºã™ã‚‹è¦ç´ </label>
      <div id="elementSelector">
        <label>
          <input
            type="checkbox"
            id="toggleModelA"
            name="modelVisibility"
            value="A"
            checked
          />
          ãƒ¢ãƒ‡ãƒ«Aã‚’è¡¨ç¤º
        </label>
        <br />
        <label>
          <input
            type="checkbox"
            id="toggleModelB"
            name="modelVisibility"
            value="B"
            checked
          />
          ãƒ¢ãƒ‡ãƒ«Bã‚’è¡¨ç¤º
        </label>
        <hr />
        <!-- åŒºåˆ‡ã‚Šç·šã‚’è¿½åŠ  -->
        <label>æ¯”è¼ƒ/è¡¨ç¤ºã™ã‚‹è¦ç´ </label> <br />
        <!-- æ”¹è¡Œã‚’è¿½åŠ  -->
        <label>
          <input
            type="checkbox"
            name="elements"
            value="Node"
            id="toggleNodeView"
            checked
          />
          ç¯€ç‚¹ (Node)
        </label>
        <label for="toggleLabel-Node">
          <input
            type="checkbox"
            name="labelToggle"
            value="Node"
            id="toggleLabel-Node"
          />
          ID
        </label>
        <br />
        <label>
          <input type="checkbox" name="elements" value="Column" checked /> æŸ±
          (Column)
        </label>
        <!-- â–¼æŸ±è¡¨ç¤ºåˆ‡æ›¿UIè¿½åŠ â–¼ -->
        <label for="toggleColumnView" class="margin-left-8">
          <input type="checkbox" id="toggleColumnView" name="columnViewMode" />
          ç«‹ä½“è¡¨ç¤º
        </label>
        <!-- â–²æŸ±è¡¨ç¤ºåˆ‡æ›¿UIè¿½åŠ â–² -->
        <label for="toggleLabel-Column" class="margin-left-8">
          <input
            type="checkbox"
            name="labelToggle"
            value="Column"
            id="toggleLabel-Column"
          />
          ID
        </label>
        <br />
        <label>
          <input type="checkbox" name="elements" value="Girder" checked /> å¤§æ¢
          (Girder)
        </label>
        <label for="toggleGirderView" class="margin-left-8">
          <input type="checkbox" id="toggleGirderView" name="girderViewMode" />
          ç«‹ä½“è¡¨ç¤º
        </label>
        <label for="toggleLabel-Girder" class="margin-left-8">
          <input
            type="checkbox"
            name="labelToggle"
            value="Girder"
            id="toggleLabel-Girder"
          />
          ID
        </label>
        <br />
        <label>
          <input type="checkbox" name="elements" value="Beam" checked /> å°æ¢
          (Beam)
        </label>
        <label for="toggleLabel-Beam">
          <input
            type="checkbox"
            name="labelToggle"
            value="Beam"
            id="toggleLabel-Beam"
          />
          ID
        </label>
        <br />
        <label>
          <input
            type="checkbox"
            name="elements"
            value="Brace"
            id="toggleBraceView"
            checked
          />
          ãƒ–ãƒ¬ãƒ¼ã‚¹ (Brace)
        </label>
        <label for="toggleLabel-Brace">
          <input
            type="checkbox"
            name="labelToggle"
            value="Brace"
            id="toggleLabel-Brace"
          />
          ID
        </label>
        <br />
        <label>
          <input
            type="checkbox"
            name="elements"
            value="Slab"
            id="toggleSlabView"
            checked
          />
          ã‚¹ãƒ©ãƒ– (Slab)
        </label>
        <label for="toggleLabel-Slab">
          <input
            type="checkbox"
            name="labelToggle"
            value="Slab"
            id="toggleLabel-Slab"
          />
          ID
        </label>
        <br />
        <label>
          <input
            type="checkbox"
            name="elements"
            value="Wall"
            id="toggleWallView"
            checked
          />
          å£ (Wall)
        </label>
        <label for="toggleLabel-Wall">
          <input
            type="checkbox"
            name="labelToggle"
            value="Wall"
            id="toggleLabel-Wall"
          />
          ID
        </label>
        <br />
        <label>
          <input
            type="checkbox"
            name="elements"
            value="Axis"
            id="toggleAxisView"
            checked
          />
          é€šã‚ŠèŠ¯ (Axis)
        </label>
        <label for="toggleLabel-Axis">
          <input
            type="checkbox"
            name="labelToggle"
            value="Axis"
            id="toggleLabel-Axis"
            checked
          />
          åç§°
        </label>
        <br />
        <label>
          <input
            type="checkbox"
            name="elements"
            value="Story"
            id="toggleStoryView"
            checked
          />
          éš (Story)
        </label>
        <label for="toggleLabel-Story">
          <input
            type="checkbox"
            name="labelToggle"
            value="Story"
            id="toggleLabel-Story"
            checked
          />
          åç§°/é«˜ã•
        </label>
        <!-- ä»–ã®è¦ç´  (Story, Axis) ã¯ç¾çŠ¶æœªå¯¾å¿œ -->
      </div>
      <hr />

      <label for="storySelector">éšã®è¡¨ç¤ºåˆ¶é™</label>
      <select id="storySelector"></select>
      <div id="storyButtons">
        <!-- â˜…â˜…â˜… onclick å±æ€§ã‚’å‰Šé™¤ â˜…â˜…â˜… -->
        <button id="applyStoryClipButton">ã“ã®éšã®Â±1mã§ã‚¯ãƒªãƒƒãƒ—</button>
        <!-- â˜…â˜…â˜… è¿½åŠ : Xè»¸é¸æŠã¨ã‚¯ãƒªãƒƒãƒ—ãƒœã‚¿ãƒ³ â˜…â˜…â˜… -->
        <label for="xAxisSelector">Xè»¸é¸æŠ:</label>
        <select id="xAxisSelector"></select>
        <!-- â˜…â˜…â˜… onclick å±æ€§ã‚’å‰Šé™¤ã—ã€IDã‚’è¿½åŠ  â˜…â˜…â˜… -->
        <button id="applyXAxisClipButton">Xè»¸ã§ã‚¯ãƒªãƒƒãƒ—</button>
        <!-- â˜…â˜…â˜… è¿½åŠ : Yè»¸é¸æŠã¨ã‚¯ãƒªãƒƒãƒ—ãƒœã‚¿ãƒ³ â˜…â˜…â˜… -->
        <label for="yAxisSelector">Yè»¸é¸æŠ:</label>
        <select id="yAxisSelector"></select>
        <!-- â˜…â˜…â˜… onclick å±æ€§ã‚’å‰Šé™¤ã—ã€IDã‚’è¿½åŠ  â˜…â˜…â˜… -->
        <button id="applyYAxisClipButton">Yè»¸ã§ã‚¯ãƒªãƒƒãƒ—</button>
        <!-- â˜…â˜…â˜… å¤‰æ›´: ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è§£é™¤ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ±ç”¨çš„ã« â˜…â˜…â˜… -->
        <button id="clearClipButton">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è§£é™¤</button>
      </div>

      <hr />

      <button id="toggleLegendBtn">å‡¡ä¾‹ãƒ»ãƒã‚¦ã‚¹æ“ä½œã‚’è¡¨ç¤º</button>
      <!-- Add this button -->
    </div>

    <!-- ã“ã“ã«å‡¡ä¾‹ãƒ‘ãƒãƒ«ã®HTMLã‚’è¿½åŠ  -->
    <div id="legendPanel" class="panel legend-panel-hidden">
      <!-- åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º -->
      <div class="panel-header">å‡¡ä¾‹</div>
      <div class="legend-content">
        <div class="legend-item">
          <span class="legend-color legend-color-matched"></span>
          <span>ä¸€è‡´è¦ç´ </span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-onlya"></span>
          <span>ãƒ¢ãƒ‡ãƒ«Aã®ã¿</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-onlyb"></span>
          <span>ãƒ¢ãƒ‡ãƒ«Bã®ã¿</span>
        </div>
        <hr />
        <div class="legend-item">
          <span><b>æ“ä½œæ–¹æ³•:</b></span>
        </div>
        <div class="legend-item">
          <span>å›è»¢: å·¦ãƒ‰ãƒ©ãƒƒã‚°</span>
        </div>
        <div class="legend-item">
          <span>å¹³è¡Œç§»å‹•: å³ãƒ‰ãƒ©ãƒƒã‚°</span>
        </div>
        <div class="legend-item">
          <span>ã‚ºãƒ¼ãƒ : ãƒ›ã‚¤ãƒ¼ãƒ«</span>
        </div>
      </div>
    </div>
    <!-- /å‡¡ä¾‹ãƒ‘ãƒãƒ« -->

    <!-- â˜…â˜…â˜… è¿½åŠ : è¦ç´ æƒ…å ±è¡¨ç¤ºãƒ‘ãƒãƒ« â˜…â˜…â˜… -->
    <div id="component-info" class="panel info-panel">
      <!-- ç·¨é›†æ©Ÿèƒ½UI (æœ€å°åŒ–) -->
      <div id="editing-controls" style="font-size: 0.8em; opacity: 0.7; margin-bottom: 8px;">
        <button
          id="edit-mode-button"
          class="btn btn-sm"
          style="font-size: 0.7em; padding: 2px 6px; background: #f8f9fa; border: 1px solid #dee2e6; color: #6c757d;"
          onclick="window.toggleEditMode()"
          title="é«˜åº¦ãªç·¨é›†æ©Ÿèƒ½ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰"
        >
          ç·¨é›†
        </button>
        <span id="editing-summary" style="font-size: 0.7em; color: #6c757d; margin-left: 5px;">
          ä¿®æ­£: 0ä»¶
        </span>
      </div>
      <div id="element-info-content">è¦ç´ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
    </div>
    <!-- /è¦ç´ æƒ…å ±è¡¨ç¤ºãƒ‘ãƒãƒ« -->

    <canvas id="three-canvas"></canvas>

    <!-- é–‹ç™ºè€…å‘ã‘ãƒªãƒ³ã‚¯ (æœ¬ç•ªç’°å¢ƒã§ã¯å‰Šé™¤) -->
    <div id="dev-tools" style="position: fixed; bottom: 10px; right: 10px; z-index: 1000; display: none;">
      <a href="test.html" 
         style="background: #666; color: white; padding: 4px 8px; text-decoration: none; 
                border-radius: 3px; font-size: 11px; opacity: 0.7;"
         title="é–‹ç™ºè€…å‘ã‘ãƒ†ã‚¹ãƒˆç’°å¢ƒ">
        ğŸ§ª Tests
      </a>
    </div>
    
    <!-- é–‹ç™ºç’°å¢ƒã§ã®ã¿ãƒ†ã‚¹ãƒˆãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º -->
    <script>
      if (window.location.hostname === 'localhost' || 
          window.location.hostname === '127.0.0.1' ||
          window.location.search.includes('dev=true')) {
        document.getElementById('dev-tools').style.display = 'block';
      }
    </script>

    <!-- â˜…â˜…â˜… ãƒ‘ã‚¹ã‚’ js/main.js ã«å¤‰æ›´ â˜…â˜…â˜… -->
    <script type="module" src="js/main.js"></script>

    <!-- â˜…â˜…â˜… è¿½åŠ : selectComponentInfo.js ã® script ã‚¿ã‚°ã¯ä¸è¦ (main.js ã‹ã‚‰ import ã•ã‚Œã‚‹ãŸã‚) â˜…â˜…â˜… -->
    <!-- <script type="module" src="selectComponentInfo.js"></script> -->
  </body>
</html>
