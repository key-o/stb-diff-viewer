<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>STB Diff Viewer</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="./style/variables.css" />
    <link rel="stylesheet" href="./style/style.css" />
    <link rel="stylesheet" href="./style/utilities.css" />
    <link rel="stylesheet" href="./style/components/floating.css" />
    <link rel="stylesheet" href="./style/components/accordion.css" />
    <link rel="stylesheet" href="./style/components/buttons.css" />
    <link rel="stylesheet" href="./style/components/tree.css" />
    <link rel="stylesheet" href="./style/components/forms.css" />
    <link rel="stylesheet" href="./style/components/panels.css" />
    <link rel="stylesheet" href="./style/components/color-modes.css" />
    <link rel="stylesheet" href="./style/components/diff.css" />
    <link rel="stylesheet" href="./style/components/clipping.css" />
    <link rel="stylesheet" href="./style/components/comparison.css" />
    <link rel="stylesheet" href="./style/components/importance.css" />
    <link rel="stylesheet" href="./style/components/dxf.css" />
    <link rel="stylesheet" href="./style/components/diffList.css" />
    <link rel="stylesheet" href="./style/components/theme.css" />
    <link rel="stylesheet" href="./style/components/toast.css" />
    <link rel="stylesheet" href="./style/components/load-visualization.css" />
    <link rel="stylesheet" href="./style/components/view-cube.css" />
    <link rel="stylesheet" href="./style/components/section-list.css" />
    <link rel="stylesheet" href="./style/components/beam-section-list.css" />
    <link rel="stylesheet" href="./style/components/parameter-editor.css" />
    <link rel="stylesheet" href="./style/components/ar-mode.css" />
    <!-- Import map for bare module specifiers used in ES modules (browser) -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
          "camera-controls": "https://unpkg.com/camera-controls@3.1.0/dist/camera-controls.module.js",
          "xml2js": "https://esm.sh/xml2js@0.6.2",
          "dxf-parser": "https://esm.sh/dxf-parser@1.1.2",
          "html2canvas": "https://esm.sh/html2canvas@1.4.1",
          "jspdf": "https://esm.sh/jspdf@2.5.1",
          "ajv": "https://esm.sh/ajv@8.17.1"
        }
      }
    </script>
  </head>
  <body>
    <div id="overlay">
      <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰ -->
      <div class="view-mode-toggle">
        <div class="view-mode-buttons">
          <button
            type="button"
            class="view-mode-btn active"
            data-mode="perspective"
            id="viewModePerspectiveBtn"
          >
            ğŸ  ç«‹ä½“è¡¨ç¤º
          </button>
          <button
            type="button"
            class="view-mode-btn"
            data-mode="orthographic"
            id="viewModeOrthographicBtn"
          >
            ğŸ“„ å›³é¢è¡¨ç¤º
          </button>
          <button
            type="button"
            class="view-mode-btn ar-mode-btn"
            id="arModeButton"
            style="display: none"
            title="ARè¡¨ç¤ºï¼ˆå¯¾å¿œãƒ‡ãƒã‚¤ã‚¹ã®ã¿ï¼‰"
          >
            ARè¡¨ç¤º
          </button>
        </div>
        <!-- ãƒ“ãƒ¥ãƒ¼æ–¹å‘ãƒœã‚¿ãƒ³ï¼ˆ2Dãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
        <div id="viewDirectionButtons" class="view-direction-buttons hidden">
          <button type="button" class="view-dir-btn" data-view="top" title="å¹³é¢å›³ï¼ˆä¸Šã‹ã‚‰ï¼‰">
            å¹³é¢
          </button>
          <button type="button" class="view-dir-btn" data-view="front" title="æ­£é¢å›³ï¼ˆY-æ–¹å‘ï¼‰">
            æ­£é¢
          </button>
          <button type="button" class="view-dir-btn" data-view="right" title="å³å´é¢å›³ï¼ˆX+æ–¹å‘ï¼‰">
            å³å´
          </button>
          <button type="button" class="view-dir-btn" data-view="left" title="å·¦å´é¢å›³ï¼ˆX-æ–¹å‘ï¼‰">
            å·¦å´
          </button>
          <button type="button" class="view-dir-btn" data-view="iso" title="ç­‰è§’å›³">ç­‰è§’</button>
        </div>
      </div>

      <!-- ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã¨æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="accordion-section">
        <div
          class="accordion-header"
          data-target="file-loading"
          role="button"
          tabindex="0"
          aria-controls="file-loading"
          aria-expanded="true"
        >
          <span>ğŸ“Š ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿</span>
          <span class="accordion-arrow">â–¼</span>
        </div>
        <div class="accordion-content" id="file-loading" aria-hidden="false">
          <div class="file-input-wrapper" id="wrapperA">
            <div class="model-header">
              <label for="fileA"><strong>ãƒ¢ãƒ‡ãƒ«A</strong></label>
              <span class="version-badge-inline" id="versionA-inline"></span>
              <button type="button" class="custom-file-btn" data-target="fileA">
                é¸æŠ
              </button>
            </div>
            <span class="file-name-display" id="fileNameA">æœªé¸æŠ</span>
            <input type="file" id="fileA" accept=".stb,.xml" />
          </div>

          <div class="file-input-wrapper" id="wrapperB">
            <div class="model-header">
              <label for="fileB"><strong>ãƒ¢ãƒ‡ãƒ«B</strong></label>
              <span class="version-badge-inline" id="versionB-inline"></span>
              <button type="button" class="custom-file-btn" data-target="fileB">
                é¸æŠ
              </button>
            </div>
            <span class="file-name-display" id="fileNameB">æœªé¸æŠ</span>
            <input type="file" id="fileB" accept=".stb,.xml" />
          </div>

          <hr class="section-divider" />

          <button type="button" id="compareButton" class="btn-primary compare-button">
            ğŸ” èª­è¾¼ / æ¯”è¼ƒå®Ÿè¡Œ
          </button>

          <!-- å·®åˆ†çµæœã‚µãƒãƒªãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
          <div id="diff-summary" class="hidden">
            <div class="diff-summary-title">ğŸ“ˆ å·®åˆ†ã‚µãƒãƒªãƒ¼</div>
            <div id="diff-summary-content">
              <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹å·®åˆ†çµ±è¨ˆ -->
            </div>
          </div>
        </div>
      </div>

      <!-- è¡¨ç¤ºè¨­å®šãƒœã‚¿ãƒ³ï¼ˆç›´æ¥è¡¨ç¤ºï¼‰ -->
      <button
        type="button"
        id="toggle-element-settings-btn"
        class="btn-white"
        aria-controls="element-settings-float"
        aria-expanded="false"
      >
        ğŸ—ï¸ è¡¨ç¤ºè¦ç´ è¨­å®š
      </button>
      <button
        type="button"
        id="toggle-clipping-settings-btn"
        class="btn-white"
        aria-controls="clipping-settings-float"
        aria-expanded="false"
      >
        âœ‚ï¸ è¡¨ç¤ºç¯„å›²è¨­å®š
      </button>

      <button
        type="button"
        id="toggle-display-settings-btn"
        aria-controls="display-settings-float"
        aria-expanded="false"
      >
        ğŸ¨ è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰è¨­å®š
      </button>
      <button
        type="button"
        id="toggle-component-info-btn"
        aria-controls="component-info"
        aria-expanded="false"
      >
        ğŸ“‹ è¦ç´ æƒ…å ±
      </button>
      <button type="button" id="toggle-tree-view-btn">ğŸŒ³ ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼</button>
      <button
        type="button"
        id="toggle-importance-panel-btn"
        aria-controls="importance-panel"
        aria-expanded="false"
      >
        ğŸ·ï¸ é‡è¦åº¦è¨­å®š
      </button>
      <button
        type="button"
        id="toggle-validation-panel-btn"
        aria-controls="validation-panel-float"
        aria-expanded="false"
      >
        âœ… STBãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      </button>

      <!-- å‡ºåŠ›ãƒ»å¤‰æ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="accordion-section">
        <div
          class="accordion-header"
          data-target="other-settings"
          role="button"
          tabindex="0"
          aria-controls="other-settings"
          aria-expanded="false"
        >
          <span>ğŸ“¤ å‡ºåŠ›ãƒ»å¤‰æ›</span>
          <span class="accordion-arrow">â–¼</span>
        </div>
        <div class="accordion-content collapsed" id="other-settings" aria-hidden="true">
          <div class="theme-settings">
            <span class="theme-settings-label">ãƒ†ãƒ¼ãƒ:</span>
            <div class="theme-button-group" id="theme-button-group">
              <button type="button" data-theme="light" class="active">ãƒ©ã‚¤ãƒˆ</button>
              <button type="button" data-theme="dark">ãƒ€ãƒ¼ã‚¯</button>
              <button type="button" data-theme="system">è‡ªå‹•</button>
            </div>
          </div>

          <!-- DXF/IFCå‡ºåŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div class="export-settings">
            <label><strong>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</strong></label>
            <button type="button" id="toggle-dxf-floating-btn" class="btn btn-secondary">
              ğŸ“ DXFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            </button>
            <button type="button" id="exportIfcBtn" class="btn btn-secondary">
              ğŸ“¦ IFCãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›
            </button>
            <button type="button" id="exportReportBtn" class="btn btn-secondary" disabled
              title="æ¯”è¼ƒçµæœã‚’HTMLãƒ¬ãƒãƒ¼ãƒˆã¨ã—ã¦å‡ºåŠ›ï¼ˆæ¯”è¼ƒå®Ÿè¡Œå¾Œã«æœ‰åŠ¹åŒ–ï¼‰">
              æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
            </button>
            <label style="font-size: 0.85em; display: flex; align-items: center; gap: 4px; cursor: pointer;">
              <input type="checkbox" id="reportMultiViewCheck">
              è¤‡æ•°ã‚¢ãƒ³ã‚°ãƒ«ã‚’å«ã‚ã‚‹
            </label>
          </div>

          <!-- RCæŸ±æ–­é¢ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div class="export-settings">
            <label><strong>æ–­é¢ãƒªã‚¹ãƒˆ</strong></label>
            <button type="button" id="showColumnSectionListBtn" class="btn btn-secondary">
              RCæŸ±æ–­é¢ãƒªã‚¹ãƒˆ
            </button>
            <button type="button" id="showBeamSectionListBtn" class="btn btn-secondary">
              RCæ¢æ–­é¢ãƒªã‚¹ãƒˆ
            </button>
          </div>

          <!-- STBãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div class="export-settings">
            <label><strong>STBãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›</strong></label>
            <button
              type="button"
              id="convertTo210Btn"
              class="btn btn-secondary"
              disabled
              title="ãƒ¢ãƒ‡ãƒ«Aã‚’ STB 2.1.0 å½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
            >
              â¬†ï¸ 2.1.0 ã«å¤‰æ›
            </button>
            <button
              type="button"
              id="convertTo202Btn"
              class="btn btn-secondary"
              disabled
              title="ãƒ¢ãƒ‡ãƒ«Aã‚’ STB 2.0.2 å½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
            >
              â¬‡ï¸ 2.0.2 ã«å¤‰æ›
            </button>
            <div id="stbConvertStatus" class="stb-convert-status hidden"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
    <canvas id="three-canvas"></canvas>

    <script>
      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã®ã‚«ã‚¹ã‚¿ãƒ ãƒœã‚¿ãƒ³æŒ™å‹•ã‚’è¨­å®š
      (function () {
        function updateCompareButtonLabel() {
          var compareButton = document.getElementById('compareButton');
          var inputA = document.getElementById('fileA');
          var inputB = document.getElementById('fileB');
          if (!compareButton || !inputA || !inputB) return;

          var hasA = inputA.files && inputA.files.length > 0;
          var hasB = inputB.files && inputB.files.length > 0;

          if (hasA && hasB) {
            compareButton.textContent = 'ğŸ” æ¯”è¼ƒå®Ÿè¡Œ';
            return;
          }
          if (hasA || hasB) {
            compareButton.textContent = 'ğŸ” ãƒ¢ãƒ‡ãƒ«èª­è¾¼';
            return;
          }
          compareButton.textContent = 'ğŸ” èª­è¾¼ / æ¯”è¼ƒå®Ÿè¡Œ';
        }

        function wire(targetId) {
          var btn = document.querySelector('.custom-file-btn[data-target="' + targetId + '"]');
          var input = document.getElementById(targetId);
          // ãƒ•ã‚¡ã‚¤ãƒ«åè¡¨ç¤ºè¦ç´ ï¼ˆfileAâ†’fileNameA, fileBâ†’fileNameBï¼‰
          var nameEl = document.getElementById('fileName' + targetId.charAt(targetId.length - 1));
          // wrapperè¦ç´ ï¼ˆhas-fileã‚¯ãƒ©ã‚¹ä»˜ä¸ç”¨ï¼‰
          var wrapper = document.getElementById('wrapper' + targetId.charAt(targetId.length - 1));
          if (!btn || !input) return;
          btn.addEventListener('click', function () {
            input.click();
          });
          input.addEventListener('change', function () {
            var f = input.files && input.files[0];
            if (f) {
              // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’åˆ¥è¦ç´ ã«å…¨åè¡¨ç¤ºï¼ˆæŠ˜ã‚Šè¿”ã—ã¯CSSã§å¯¾å¿œï¼‰
              if (nameEl) {
                nameEl.textContent = f.name;
                nameEl.title = f.name;
              }
              btn.classList.add('has-file');
              if (wrapper) wrapper.classList.add('has-file');
            } else {
              if (nameEl) {
                nameEl.textContent = 'æœªé¸æŠ';
                nameEl.title = '';
              }
              btn.classList.remove('has-file');
              if (wrapper) wrapper.classList.remove('has-file');
            }
            updateCompareButtonLabel();
          });
        }

        function wireAll() {
          wire('fileA');
          wire('fileB');
          wire('dxfFile');
          updateCompareButtonLabel();
          window.updateCompareButtonLabel = updateCompareButtonLabel;
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', wireAll);
        } else {
          wireAll();
        }
      })();
    </script>

    <!-- å‡¡ä¾‹ãƒ‘ãƒãƒ« -->
    <div id="legendPanel" class="panel legend-panel-hidden">
      <div class="panel-header">ğŸ” å·®åˆ†æ¯”è¼ƒå‡¡ä¾‹</div>
      <div class="legend-content">
        <div class="legend-item">
          <span class="legend-color legend-color-matched"></span>
          <span><strong>ä¸€è‡´è¦ç´ </strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-onlya"></span>
          <span><strong>ãƒ¢ãƒ‡ãƒ«Aã®ã¿</strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-onlyb"></span>
          <span><strong>ãƒ¢ãƒ‡ãƒ«Bã®ã¿</strong></span>
        </div>
        <hr />
        <div class="legend-item">
          <span class="legend-description">è‰²åˆ†ã‘ã§å·®åˆ†ã‚’ç›´æ„Ÿçš„ã«ç¢ºèªã§ãã¾ã™</span>
        </div>
        <hr />
        <div class="legend-item">
          <span><b>æ“ä½œæ–¹æ³•:</b></span>
        </div>
        <div class="legend-item"><span>å›è»¢: å·¦ãƒ‰ãƒ©ãƒƒã‚°</span></div>
        <div class="legend-item"><span>å¹³è¡Œç§»å‹•: å³ãƒ‰ãƒ©ãƒƒã‚°</span></div>
        <div class="legend-item"><span>ã‚ºãƒ¼ãƒ : ãƒ›ã‚¤ãƒ¼ãƒ«</span></div>
      </div>
    </div>

    <!-- è¦ç´ æƒ…å ±è¡¨ç¤ºãƒ‘ãƒãƒ« -->
    <div id="component-info" class="floating-window component-info-resizable">
      <div class="float-window-header" id="component-info-header">
        <span class="float-window-title">ğŸ“‹ è¦ç´ æƒ…å ±</span>
        <div class="float-window-controls">
          <button
            class="float-window-btn"
            id="close-component-info-btn"
            aria-label="é–‰ã˜ã‚‹"
            type="button"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content" id="component-info-content-wrapper">
        <div id="editing-controls" class="editing-controls-muted">
          <button
            id="edit-mode-button"
            class="btn btn-sm"
            onclick="window.toggleEditMode()"
            title="é«˜åº¦ãªç·¨é›†æ©Ÿèƒ½ï¼ˆé–‹ç™ºè€…å‘ã‘)"
            type="button"
          >
            ç·¨é›†
          </button>
          <span id="editing-summary" class="editing-summary-text">ä¿®æ­£: 0ä»¶</span>
          <button
            id="json-export-button"
            class="btn btn-sm"
            onclick="window.exportElementInfoAsJson()"
            title="è¡¨ç¤ºä¸­ã®è¦ç´ æƒ…å ±ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
            type="button"
          >
            JSONå‡ºåŠ›
          </button>
        </div>
        <div id="element-info-content">è¦ç´ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
      </div>
    </div>

    <!-- ç’°å¢ƒè¨­å®šç®¡ç† -->
    <script type="module">
      import {
        getEnvironmentConfig,
        isFeatureEnabled,
        displayEnvironmentInfo,
      } from './js/config/environment.js';

      async function initializeEnvironment() {
        try {
          window.envConfig = await getEnvironmentConfig();
          if (window.envConfig.features.devTools) {
            const devToolsEl = document.getElementById('dev-tools');
            if (devToolsEl) {
              devToolsEl.style.display = 'block';
            }
            await displayEnvironmentInfo();
          }
          try {
            window.AppLogger?.setLevel &&
              window.AppLogger.setLevel(window.envConfig?.logLevel || 'warn');
          } catch (e) {}
          console.log('âœ… ç’°å¢ƒè¨­å®šåˆæœŸåŒ–å®Œäº†:', window.envConfig.environment);
        } catch (error) {
          console.error('âŒ ç’°å¢ƒè¨­å®šåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
          window.envConfig = {
            environment: 'production',
            stb2ifc: {
              apiBaseUrl: 'https://stb2ifc-api-e23mdd6kwq-an.a.run.app',
            },
            features: { devTools: false },
          };
        }
      }

      window.isFeatureEnabled = isFeatureEnabled;
      window.getEnvironmentConfig = getEnvironmentConfig;
      initializeEnvironment();
    </script>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script type="module" src="js/main.js"></script>

    <!-- é–‹ç™ºç”¨: æ–­é¢å·®ç•°è¨ºæ–­ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
    <script type="module" src="js/diagnostics/geometryInspector.js"></script>
    <script type="module" src="js/diagnostics/geometryMismatchAnalyzer.js"></script>

    <!-- è¡¨ç¤ºè¦ç´ è¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="element-settings-float" class="floating-window">
      <div class="float-window-header" id="element-settings-header">
        <span class="float-window-title">ğŸ—ï¸ è¡¨ç¤ºè¦ç´ è¨­å®š</span>
        <div class="float-window-controls">
          <button
            class="float-window-btn"
            id="close-element-settings-btn"
            aria-label="é–‰ã˜ã‚‹"
            type="button"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="elementSelector">
          <label><strong>ãƒ¢ãƒ‡ãƒ«è¡¨ç¤º</strong></label>
          <label>
            <input type="checkbox" id="toggleModelA" name="modelVisibility" value="A" checked />
            ãƒ¢ãƒ‡ãƒ«Aã‚’è¡¨ç¤º
          </label>
          <br />
          <label>
            <input type="checkbox" id="toggleModelB" name="modelVisibility" value="B" checked />
            ãƒ¢ãƒ‡ãƒ«Bã‚’è¡¨ç¤º
          </label>

          <hr class="section-divider" />

          <label><strong>ãƒ©ãƒ™ãƒ«è¡¨ç¤ºå†…å®¹</strong></label>
          <select
            id="labelContentSelector"
            class="form-control mb-2"
            title="ãƒ©ãƒ™ãƒ«ã«è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’é¸æŠ"
          >
            <option value="id">ã‚¿ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</option>
            <option value="name">ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åï¼ˆNameï¼‰</option>
            <option value="section">æ–­é¢åï¼ˆSectionï¼‰</option>
          </select>

          <hr class="section-divider" />

          <label><strong>æ¯”è¼ƒ/è¡¨ç¤ºã™ã‚‹è¦ç´ </strong></label>
          <table class="element-settings-table">
            <thead>
              <tr>
                <th>è¦ç´ </th>
                <th>
                  è¡¨ç¤º
                  <input
                    type="checkbox"
                    id="masterToggleDisplay"
                    title="å…¨ã¦ã®è¡¨ç¤ºã‚’åˆ‡æ›¿"
                    checked
                  />
                </th>
                <th>
                  ç«‹ä½“
                  <input
                    type="checkbox"
                    id="masterToggleSolid"
                    title="å…¨ã¦ã®ç«‹ä½“è¡¨ç¤ºã‚’åˆ‡æ›¿"
                    checked
                  />
                </th>
                <th>
                  ãƒ©ãƒ™ãƒ«
                  <input
                    type="checkbox"
                    id="masterToggleLabel"
                    title="å…¨ã¦ã®ãƒ©ãƒ™ãƒ«è¡¨ç¤ºã‚’åˆ‡æ›¿"
                  />
                </th>
                <th>è‰²</th>
              </tr>
            </thead>
            <tbody id="element-settings-body">
              <!-- å‹•çš„ã«ç”Ÿæˆ (elementSettingsTable.js) -->
            </tbody>
          </table>

          <div class="element-color-reset-container">
            <button
              type="button"
              id="resetElementColors"
              class="btn-reset"
              title="éƒ¨æè‰²ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™"
            >
              ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²ã«æˆ»ã™
            </button>
          </div>

          <div class="origin-axes-control">
            <label for="toggleOriginAxes">
              <input type="checkbox" id="toggleOriginAxes" />
              åŸç‚¹ï¼ˆXYZè»¸ï¼‰ã‚’è¡¨ç¤º
            </label>
          </div>

          <div class="placement-line-control">
            <label for="togglePlacementLines">
              <input type="checkbox" id="togglePlacementLines" />
              ç«‹ä½“è¡¨ç¤ºæ™‚ã®é…ç½®åŸºæº–ç·šã‚’è¡¨ç¤º
            </label>
          </div>

          <div class="load-display-control">
            <label for="toggleLoadDisplay">
              <input type="checkbox" id="toggleLoadDisplay" />
              è·é‡ã‚’çŸ¢å°ã§è¡¨ç¤º (StbCalData)
            </label>
            <select id="loadCaseSelector" title="è·é‡ã‚±ãƒ¼ã‚¹ã‚’é¸æŠ">
              <option value="">å…¨ã¦ã®è·é‡ã‚±ãƒ¼ã‚¹</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="display-settings-float" class="floating-window">
      <div class="float-window-header" id="display-settings-header">
        <span class="float-window-title">ğŸ¨ è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰è¨­å®š</span>
        <div class="float-window-controls">
          <button
            class="float-window-btn"
            id="close-display-settings-btn"
            aria-label="é–‰ã˜ã‚‹"
            type="button"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="color-mode-controls">
          <label><strong>è‰²åˆ†ã‘ãƒ¢ãƒ¼ãƒ‰</strong></label>
          <div class="diff-mode-description">å·®åˆ†ç¢ºèªã«ã¯ã€Œå·®åˆ†è¡¨ç¤ºã€ã‚’æ¨å¥¨ã—ã¾ã™</div>
          <select id="colorModeSelector" class="form-control" title="è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ">
            <option value="diff">ğŸ” å·®åˆ†è¡¨ç¤ºï¼ˆæ¨å¥¨ï¼‰</option>
            <option value="element">ğŸ—ï¸ éƒ¨æåˆ¥è‰²ä»˜ã‘</option>
            <option value="schema">âš ï¸ ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è¡¨ç¤º</option>
            <option value="importance">ğŸ·ï¸ é‡è¦åº¦åˆ¥è‰²ä»˜ã‘</option>
          </select>

          <div id="comparison-key-settings" class="comparison-key-settings">
            <hr class="settings-separator" />
            <div id="comparison-key-selector-container"></div>
          </div>

          <div id="diff-filter-settings" class="diff-filter-settings">
            <hr class="settings-separator" />
            <label class="color-setting-label">å·®åˆ†ãƒ•ã‚£ãƒ«ã‚¿:</label>
            <div class="color-setting-help">
              â€» è¡¨ç¤ºã™ã‚‹å·®åˆ†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é¸æŠã§ãã¾ã™ï¼ˆ6ã‚«ãƒ†ã‚´ãƒªï¼‰
            </div>
            <div class="diff-filter-presets">
              <button
                type="button"
                class="btn btn-sm preset-btn"
                data-preset="all"
                title="ã™ã¹ã¦ã®è¦ç´ ã‚’è¡¨ç¤º"
              >
                å…¨è¡¨ç¤º
              </button>
              <button
                type="button"
                class="btn btn-sm preset-btn"
                data-preset="differencesOnly"
                title="å·®åˆ†ï¼ˆãƒ¢ãƒ‡ãƒ«A/Bã®ã¿ï¼‰ã‚’è¡¨ç¤º"
              >
                å·®åˆ†ã®ã¿
              </button>
              <button
                type="button"
                class="btn btn-sm preset-btn"
                data-preset="matchedOnly"
                title="ä¸¡æ–¹ã®ãƒ¢ãƒ‡ãƒ«ã«ã‚ã‚‹è¦ç´ ã‚’è¡¨ç¤º"
              >
                å…±é€šã®ã¿
              </button>
              <button
                type="button"
                class="btn btn-sm preset-btn"
                data-preset="changesOnly"
                title="å¤‰æ›´ãŒã‚ã£ãŸè¦ç´ ã®ã¿è¡¨ç¤º"
              >
                å¤‰æ›´ã®ã¿
              </button>
            </div>
            <div class="color-legend-container" id="diff-filter-legend">
              <!-- å·®åˆ†ãƒ•ã‚£ãƒ«ã‚¿å‡¡ä¾‹ã¯config/diffFilterConfig.jsã‹ã‚‰å‹•çš„ç”Ÿæˆã•ã‚Œã¾ã™ -->
            </div>
            <div class="diff-filter-summary">
              <span
                >è¡¨ç¤ºä¸­: <strong id="diff-visible-count">0</strong> /
                <span id="diff-total-count">0</span> è¦ç´ </span
              >
            </div>

            <hr class="settings-separator" />

            <!-- è¨±å®¹å·®è¨­å®šï¼ˆè‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰è¨­å®šå†…ã«çµ±åˆï¼‰ -->
            <div id="tolerance-settings-container">
              <!-- toleranceSettings.jsã«ã‚ˆã£ã¦å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
          </div>

          <div id="color-mode-status" class="color-mode-status hidden">
            <span id="color-mode-status-text"></span>
          </div>

          <div id="schema-color-settings" class="schema-color-settings">
            <label class="color-setting-label">ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è‰²è¨­å®š:</label>
            <div class="color-setting-help">â€» ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã®çµæœã«å¿œã˜ã¦è¦ç´ ã«è‰²ä»˜ã‘ã—ã¾ã™</div>
            <div class="color-legend-container">
              <div class="legend-item">
                <input
                  type="color"
                  id="schema-valid-color"
                  value="#4CAF50"
                  class="legend-color-box"
                  title="æ­£å¸¸è¦ç´ ã®è‰²ã‚’å¤‰æ›´"
                />
                <span class="legend-label">æ­£å¸¸è¦ç´ </span>
                <span id="schema-valid-count" class="legend-count badge badge-valid"></span>
              </div>
              <div class="legend-item" id="schema-info-item">
                <input
                  type="color"
                  id="schema-info-color"
                  value="#2196F3"
                  class="legend-color-box"
                  title="è‡ªå‹•ä¿®å¾©å¯èƒ½è¦ç´ ã®è‰²ã‚’å¤‰æ›´"
                />
                <span class="legend-label">è‡ªå‹•ä¿®å¾©</span>
                <span id="schema-info-count" class="legend-count badge badge-info"></span>
                <button
                  class="legend-list-btn"
                  id="schema-info-list-btn"
                  data-status="info"
                  title="è‡ªå‹•ä¿®å¾©ãŒå¿…è¦ãªè¦ç´ ã‚’ä¸€è¦§è¡¨ç¤º"
                >
                  ä¸€è¦§
                </button>
              </div>
              <div class="legend-item" id="schema-warning-item">
                <input
                  type="color"
                  id="schema-warning-color"
                  value="#FF9800"
                  class="legend-color-box"
                  title="è¦ç¢ºèªè¦ç´ ã®è‰²ã‚’å¤‰æ›´"
                />
                <span class="legend-label">è¦ç¢ºèª</span>
                <span id="schema-warning-count" class="legend-count badge badge-warning"></span>
                <button
                  class="legend-list-btn"
                  id="schema-warning-list-btn"
                  data-status="warning"
                  title="è¦ç¢ºèªã®è¦ç´ ã‚’ä¸€è¦§è¡¨ç¤º"
                >
                  ä¸€è¦§
                </button>
              </div>
              <div class="legend-item" id="schema-error-item">
                <input
                  type="color"
                  id="schema-error-color"
                  value="#F44336"
                  class="legend-color-box"
                  title="ã‚¨ãƒ©ãƒ¼è¦ç´ ã®è‰²ã‚’å¤‰æ›´"
                />
                <span class="legend-label">æ‰‹å‹•ä¿®æ­£</span>
                <span id="schema-error-count" class="legend-count badge badge-error"></span>
                <button
                  class="legend-list-btn"
                  id="schema-error-list-btn"
                  data-status="error"
                  title="æ‰‹å‹•ä¿®æ­£ãŒå¿…è¦ãªè¦ç´ ã‚’ä¸€è¦§è¡¨ç¤º"
                >
                  ä¸€è¦§
                </button>
              </div>
            </div>
          </div>

          <div id="importance-color-settings" class="importance-color-settings">
            <label class="color-setting-label">é‡è¦åº¦è‰²è¨­å®š:</label>
            <div class="color-setting-help">â€» é•åè¦ç´ ã®è¡¨ç¤ºè‰²ã‚’å¤‰æ›´ã§ãã¾ã™</div>
            <div class="color-legend-container" id="importance-color-controls"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¡¨ç¤ºç¯„å›²è¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="clipping-settings-float" class="floating-window">
      <div class="float-window-header" id="clipping-settings-header">
        <span class="float-window-title">âœ‚ï¸ è¡¨ç¤ºç¯„å›²è¨­å®š</span>
        <div class="float-window-controls">
          <button
            class="float-window-btn"
            id="close-clipping-settings-btn"
            aria-label="é–‰ã˜ã‚‹"
            type="button"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div class="section-box-group">
          <button id="toggleSectionBoxButton" class="section-box-toggle-btn" type="button">
            ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒœãƒƒã‚¯ã‚¹
          </button>
          <p class="section-box-hint hidden" id="sectionBoxHint">
            çŸ¢å°ãƒãƒ³ãƒ‰ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦è¡¨ç¤ºç¯„å›²ã‚’èª¿æ•´
          </p>
        </div>

        <hr class="section-divider" />

        <div class="clipping-group">
          <label for="storySelector"><strong>éšã®è¡¨ç¤ºåˆ¶é™</strong></label>
          <div class="clipping-row">
            <select id="storySelector"></select>
          </div>
          <div id="storyClipControls" class="clip-range-controls hidden">
            <div class="range-control-group">
              <label for="storyClipRange">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="storyClipRange"
                  min="500"
                  max="5000"
                  value="1000"
                  step="100"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">Â±<span id="storyRangeValue">1.0</span>m</div>
            </div>
          </div>
        </div>

        <hr class="section-divider" />

        <div class="clipping-group">
          <label for="xAxisSelector"><strong>Xè»¸é¸æŠ</strong></label>
          <div class="clipping-row">
            <select id="xAxisSelector"></select>
          </div>
          <div id="xAxisClipControls" class="clip-range-controls hidden">
            <div class="range-control-group">
              <label for="xAxisClipRange">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="xAxisClipRange"
                  min="500"
                  max="10000"
                  value="2000"
                  step="250"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">Â±<span id="xAxisRangeValue">2.0</span>m</div>
            </div>
          </div>
        </div>

        <hr class="section-divider" />

        <div class="clipping-group">
          <label for="yAxisSelector"><strong>Yè»¸é¸æŠ</strong></label>
          <div class="clipping-row">
            <select id="yAxisSelector"></select>
          </div>
          <div id="yAxisClipControls" class="clip-range-controls hidden">
            <div class="range-control-group">
              <label for="yAxisClipRange">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="yAxisClipRange"
                  min="500"
                  max="10000"
                  value="2000"
                  step="250"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">Â±<span id="yAxisRangeValue">2.0</span>m</div>
            </div>
          </div>
        </div>

        <hr class="section-divider" />

        <div class="clipping-controls">
          <button id="previewClipButton" class="preview-clip-btn hidden" type="button">
            ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
          </button>
        </div>
      </div>
    </div>

    <!-- DXFãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="dxf-floating" class="floating-window hidden">
      <div class="float-window-header" id="dxf-floating-header">
        <span class="float-window-title">ğŸ“ DXFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span>
        <div class="float-window-controls">
          <button
            class="float-window-btn"
            id="close-dxf-floating-btn"
            aria-label="é–‰ã˜ã‚‹"
            type="button"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <!-- STBã‹ã‚‰DXFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
        <div id="stb-dxf-export-panel" class="stb-dxf-export-panel">
          <label><strong>STBãƒ¢ãƒ‡ãƒ«ã‹ã‚‰DXFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</strong></label>
          <div id="stb-export-status" class="stb-export-status">
            <span id="stb-export-status-text">ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</span>
          </div>
          <div id="stb-export-element-select" class="stb-export-element-select hidden">
            <label>å‡ºåŠ›è¦ç´ :</label>
            <div id="stb-export-type-list" class="stb-export-type-list"></div>
            <div class="stb-export-controls">
              <button type="button" id="selectAllStbExportTypes" class="btn btn-sm">å…¨é¸æŠ</button>
              <button type="button" id="deselectAllStbExportTypes" class="btn btn-sm">
                å…¨è§£é™¤
              </button>
            </div>
          </div>
          <div id="stb-export-stats" class="stb-export-stats hidden">
            <span id="stb-export-mesh-count">ãƒ¡ãƒƒã‚·ãƒ¥: 0</span>
          </div>
          <div id="stb-export-filename-group" class="stb-export-filename-group hidden">
            <label for="stbDxfExportFilename">ãƒ•ã‚¡ã‚¤ãƒ«å:</label>
            <input
              type="text"
              id="stbDxfExportFilename"
              class="form-control"
              value="stb-export.dxf"
            />
          </div>
          <button type="button" id="exportStbDxfButton" class="btn btn-primary" disabled>
            ğŸ“¤ STBâ†’DXFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </button>

          <hr class="section-divider" />

          <!-- ãƒãƒƒãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
          <div class="batch-export-section">
            <label><strong>ãƒãƒƒãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</strong></label>
            <div class="batch-export-buttons">
              <button
                type="button"
                id="exportAllStoriesDxfBtn"
                class="btn btn-sm"
                disabled
                title="å…¨éšã®DXFã‚’å‡ºåŠ›"
              >
                å…¨éš
              </button>
              <button
                type="button"
                id="exportAllXAxesDxfBtn"
                class="btn btn-sm"
                disabled
                title="å…¨Xé€šã‚Šã®DXFã‚’å‡ºåŠ›"
              >
                å…¨Xé€šã‚Š
              </button>
              <button
                type="button"
                id="exportAllYAxesDxfBtn"
                class="btn btn-sm"
                disabled
                title="å…¨Yé€šã‚Šã®DXFã‚’å‡ºåŠ›"
              >
                å…¨Yé€šã‚Š
              </button>
              <button
                type="button"
                id="exportAllAxesDxfBtn"
                class="btn btn-sm"
                disabled
                title="å…¨é€šã‚ŠèŠ¯ã®DXFã‚’å‡ºåŠ›"
              >
                å…¨é€šã‚ŠèŠ¯
              </button>
            </div>
            <div id="batch-export-progress" class="batch-export-progress hidden">
              <span id="batch-export-progress-text">å‡¦ç†ä¸­...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- STBãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="validation-panel-float" class="floating-window hidden">
      <div class="float-window-header" id="validation-panel-header">
        <span class="float-window-title">âœ… STBãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</span>
        <div class="float-window-controls">
          <button
            type="button"
            class="float-window-btn"
            id="close-validation-panel-btn"
            aria-label="é–‰ã˜ã‚‹"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="validation-panel-container"></div>
      </div>
    </div>

    <!-- ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è¦ç´ ãƒªã‚¹ãƒˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div
      id="schema-error-list-float"
      class="floating-window"
      role="dialog"
      aria-labelledby="schema-list-modal-title"
      aria-modal="true"
    >
      <div class="float-window-header" id="schema-error-list-header">
        <span class="float-window-title">âš ï¸ <span id="schema-list-modal-title"></span></span>
        <div class="float-window-controls">
          <button
            type="button"
            class="float-window-btn"
            id="close-schema-error-list-btn"
            aria-label="é–‰ã˜ã‚‹"
          >
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="schema-list-container" class="schema-list-container"></div>
      </div>
    </div>
  </body>
</html>
