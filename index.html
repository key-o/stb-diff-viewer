<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>STB Diff Viewer</title>
    <link rel="stylesheet" href="./style/style.css" />
    <!-- Import map for bare module specifiers used in ES modules (browser) -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
          "camera-controls": "https://unpkg.com/camera-controls@3.1.0/dist/camera-controls.module.js"
        }
      }
    </script>
    <!-- è¦ç´ æƒ…å ±ãƒ‘ãƒãƒ«ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
      /* è¦ç´ æƒ…å ±ãƒ‘ãƒãƒ«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ä»˜ãï¼‰ */
      #component-info.component-info-resizable {
        top: 10px;
        left: 10px;
        min-width: 300px;
        min-height: 100px;
        width: 30vw;
        max-width: 70vw;
        overflow: hidden; /* å¤–å´ã®overflowã¯hidden */
        resize: both; /* ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ã‚’ä¿æŒ */
        padding: 0; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å«ã‚€ã®ã§ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¯0ã« */
        display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
        flex-direction: column;
      }

      #component-info.visible {
        display: flex; /* visibleã‚¯ãƒ©ã‚¹ãŒä»˜ä¸ã•ã‚ŒãŸæ™‚ã«è¡¨ç¤º */
      }

      /* è¦ç´ æƒ…å ±ãƒ‘ãƒãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ï¼ˆflexãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨ï¼‰ */
      #component-info #component-info-content-wrapper {
        flex: 1;
        overflow: auto;
        padding: 10px;
        max-height: none; /* flexãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§é«˜ã•ã‚’ç®¡ç† */
      }
      #component-info h3 {
        margin-top: 0;
        margin-bottom: 8px;
        font-size: 1.1em;
        color: #111;
      }
      #component-info pre {
        margin: 0;
        white-space: pre-wrap; /* æŠ˜ã‚Šè¿”ã—è¡¨ç¤º */
        word-wrap: break-word;
      }
      #element-info-content {
        margin-top: 0;
      }
      /* å‡¡ä¾‹ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #legendPanel {
        position: fixed; /* ç”»é¢ã«å¯¾ã—ã¦å›ºå®š */
        bottom: 10px; /* ç”»é¢ä¸‹ã‹ã‚‰ã®è·é›¢ */
        left: 10px; /* ç”»é¢å·¦ã‹ã‚‰ã®è·é›¢ */
        background-color: rgba(
          240,
          240,
          240,
          0.85
        ); /* èƒŒæ™¯è‰² (component-infoã¨åˆã‚ã›ã‚‹) */
        border: 1px solid #ccc; /* å¢ƒç•Œç·š (component-infoã¨åˆã‚ã›ã‚‹) */
        padding: 10px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° (component-infoã¨åˆã‚ã›ã‚‹) */
        min-width: 150px; /* æœ€å°å¹… */
        max-width: 300px; /* æœ€å¤§å¹…ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆåŸºæº–ã« */
        z-index: 10; /* é‡ãªã‚Šé †åº (component-infoã¨åŒã˜) */
        border-radius: 4px; /* è§’ä¸¸ (component-infoã¨åˆã‚ã›ã‚‹) */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* å½± (component-infoã¨åˆã‚ã›ã‚‹) */
        /* display: none; ã¯HTMLè¦ç´ ã®styleå±æ€§ã§åˆ¶å¾¡ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯ä¸è¦ */
      }
      /* â˜…â˜…â˜… ã“ã“ã¾ã§è¿½åŠ  â˜…â˜…â˜… */

      /* â˜…â˜…â˜… ç·¨é›†æ©Ÿèƒ½ç”¨ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      .btn {
        padding: 4px 8px;
        margin: 2px;
        border: 1px solid #ccc;
        border-radius: 3px;
        background-color: #f8f9fa;
        color: #495057; /* ã‚°ãƒ¬ãƒ¼æ–‡å­—ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š */
        cursor: pointer;
        font-size: 0.8em;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
      }
      .btn-warning {
        background-color: #ffc107;
        color: #212529;
        border-color: #ffc107;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
        border-color: #28a745;
      }
      .btn-danger {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
      }
      .btn-sm {
        padding: 2px 6px;
        font-size: 0.7em;
      }
      /* ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ */
      .camera-mode-btn {
        transition: all 0.2s ease;
        background-color: #6c757d; /* ã‚°ãƒ¬ãƒ¼èƒŒæ™¯ */
        color: white; /* ç™½æ–‡å­— */
        border-color: #6c757d;
        font-weight: 500;
      }
      .camera-mode-btn.active {
        background-color: #007bff; /* é’èƒŒæ™¯ */
        color: white; /* ç™½æ–‡å­— */
        border-color: #007bff;
        font-weight: 600;
      }
      .camera-mode-btn:hover {
        background-color: #5a6268; /* æ¿ƒã„ã‚°ãƒ¬ãƒ¼ */
        border-color: #5a6268;
        color: white;
      }
      .camera-mode-btn.active:hover {
        background-color: #0056b3; /* æ¿ƒã„é’ */
        border-color: #0056b3;
        color: white;
      }
      .edit-btn {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        color: #6c757d;
        cursor: pointer;
        font-size: 0.8em;
        margin-left: 5px;
        padding: 1px 3px;
        border-radius: 2px;
      }
      .edit-btn:hover {
        background-color: #e9ecef;
        color: #495057;
        border-color: #adb5bd;
      }
      #editing-controls {
        background-color: #f8f9fa;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        margin-bottom: 10px;
      }
      /* â˜…â˜…â˜… ç·¨é›†æ©Ÿèƒ½ç”¨ã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… è‰²åˆ†ã‘UIç”¨ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      #color-mode-controls {
        background-color: #f8f9fa;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }
      .form-control {
        width: 100%;
        padding: 4px 8px;
        border: 1px solid #ced4da;
        border-radius: 3px;
        font-size: 0.9em;
      }
      .color-legend-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
      }
      .legend-item {
        display: flex;
        align-items: center;
        font-size: 0.75em;
      }
      .legend-color-box {
        width: 24px;
        height: 24px;
        border: 2px solid #555;
        margin-right: 8px;
        display: inline-block;
        border-radius: 4px;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .legend-color-box:hover {
        border-color: #333;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }
      .legend-label {
        white-space: nowrap;
        font-weight: 500;
        color: #333;
      }
      /* è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰ç”¨è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
      .element-color-settings {
        display: none;
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }
      .schema-color-settings {
        display: none;
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }
      .importance-color-settings {
        display: none;
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }
      .color-setting-label {
        font-size: 1em;
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
        display: block;
      }
      .legend-item {
        display: flex;
        align-items: center;
        font-size: 0.85em;
        margin-bottom: 8px;
        padding: 4px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }
      .legend-item:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }
      /* è‰²ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®æ”¹å–„ */
      .color-preview {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid #fff;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2);
        margin-left: 8px;
        display: inline-block;
      }
      .color-setting-help {
        font-size: 0.8em;
        color: #666;
        margin-bottom: 8px;
        font-style: italic;
      }
      .margin-left-8 {
        margin-left: 8px;
      }
      .legend-panel-hidden {
        display: none;
      }
      .legend-color-matched {
        background-color: #00aaff;
      }
      .legend-color-onlya {
        background-color: #00ff00;
      }
      .legend-color-onlyb {
        background-color: #ff0000;
      }
      .editing-summary {
        margin-top: 8px;
        font-size: 0.9em;
      }
      .legend-color {
        width: 12px;
        height: 12px;
        border: 1px solid #ccc;
        margin-right: 4px;
        display: inline-block;
      }
      .placement-line-control {
        margin-left: 20px;
        margin-top: 8px;
        font-size: 0.9em;
        color: #666;
      }

      /* â˜…â˜…â˜… ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      .accordion-section {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        margin-bottom: 8px;
        background: #fff;
        overflow: hidden;
      }

      .accordion-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-bottom: 1px solid #dee2e6;
        padding: 12px 15px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        color: #495057;
        transition: all 0.2s ease;
        user-select: none;
      }

      .accordion-header:hover {
        background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        color: #212529;
      }

      .accordion-header span:first-child {
        display: flex;
        align-items: center;
        font-size: 0.95em;
      }

      .accordion-arrow {
        font-size: 0.8em;
        transition: transform 0.3s ease;
        color: #6c757d;
      }

      .accordion-header.collapsed .accordion-arrow {
        transform: rotate(-90deg);
      }

      .accordion-content {
        padding: 15px;
        background: #fff;
        transition: all 0.3s ease;
        max-height: 1000px;
        overflow: hidden;
      }

      .accordion-content.collapsed {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        opacity: 0;
      }

      /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å†…ã®è¦ç´ ã®èª¿æ•´ */
      .accordion-content hr {
        margin: 15px 0;
        border: none;
        border-top: 1px solid #dee2e6;
      }

      .accordion-content label {
        margin-bottom: 8px;
        font-size: 0.9em;
      }

      /* ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ã¨é¸æŠãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ãŸã‚ã®ãƒ©ãƒƒãƒ‘ãƒ¼ */
      .file-input-wrapper {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 10px;
        max-width: 100%;
      }

      /* ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ã¨ãƒ•ã‚¡ã‚¤ãƒ«åè¡¨ç¤º */
      /* input ã‚’ display:none ã«ã™ã‚‹ã¨ä¸€éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ programmatic click ãŒç„¡åŠ¹ã«ãªã‚‹ãŸã‚
         ç”»é¢å¤–ã¸é…ç½®ã—ã¦éš ã™ï¼ˆã‚¯ãƒªãƒƒã‚¯ã¯å¯èƒ½ï¼‰ */
      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      }

      .custom-file-btn {
        display: inline-block;
        padding: 6px 10px;
        border: 1px solid #ccc;
        background: #fff;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
        color: #212529; /* æ˜ç¤ºçš„ã«æ–‡å­—è‰²ã‚’æŒ‡å®šã—ã¦ç™½æ–‡å­—ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ */
        text-align: center;
        align-self: flex-start; /* è¦ªã®flexã§å¹…å…¨ä½“ã«ä¼¸ã³ãªã„ã‚ˆã†ã«ã™ã‚‹ */
      }

      .custom-file-btn:hover {
        background: #f1f3f5;
      }

      .selected-filename {
        font-size: 0.9em;
        color: #333;
        min-height: 1.2em;
        word-break: break-all;
      }

      /* âš ï¸ è­¦å‘Š: è¦–èªæ€§ã‚’æ„å›³çš„ã«æ‚ªãã™ã‚‹ç‰¹æ®Šã‚¯ãƒ©ã‚¹
         ã“ã®ã‚¯ãƒ©ã‚¹ã¯éæ¨å¥¨ã§ã™ã€‚è¦–èªæ€§ã¨ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®è¦³ç‚¹ã‹ã‚‰ä½¿ç”¨ã‚’é¿ã‘ã¦ãã ã•ã„ã€‚
         å®Ÿéš›ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒæœ‰åŠ¹ã«ãªã‚‹ã®ã¯ä¸¡æ–¹ã®ã‚¯ãƒ©ã‚¹ãŒä»˜ä¸ã•ã‚ŒãŸå ´åˆã®ã¿ã€‚
         ã“ã‚Œã¯èª¤ã£ã¦ä»–ç®‡æ‰€ã§ä½¿ã‚ã‚Œã‚‹ã®ã‚’é˜²ããŸã‚ã®ã‚»ãƒ¼ãƒ•ã‚¬ãƒ¼ãƒ‰ã§ã™ã€‚
         æ–°è¦å®Ÿè£…ã§ã¯ä½¿ç”¨ã›ãšã€é©åˆ‡ãªã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’æŒã¤ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
         ä¾‹: <button class="allow-white-on-white white-on-white">... */
      .allow-white-on-white.white-on-white {
        background: #fff;
        color: #fff;
        border: 1px solid #e9ecef;
        padding: 6px 10px;
        border-radius: 4px;
      }

      .accordion-content select,
      .accordion-content input[type="file"],
      .accordion-content button {
        margin-bottom: 10px;
      }

      .accordion-content button {
        font-size: 0.85em;
        padding: 8px 12px;
      }

      /* åˆæœŸè¡¨ç¤ºã§é–‹ã„ã¦ã„ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®èª¿æ•´ */
      .accordion-section:first-child .accordion-content,
      .accordion-section:nth-child(2) .accordion-content,
      .accordion-section:nth-child(3) .accordion-content {
        /* ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã€è¡¨ç¤ºè¨­å®šã€è¦ç´ è¡¨ç¤ºè¨­å®šã¯åˆæœŸè¡¨ç¤ºã§é–‹ã */
      }
      /* â˜…â˜…â˜… ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… å·®åˆ†æ¯”è¼ƒUIç”¨ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      .diff-comparison-intro p {
        font-size: 0.9em;
        color: #666;
        margin: 0 0 10px 0;
      }

      .btn-primary.compare-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .btn-primary.compare-button:hover {
        background: #0056b3;
      }

      #diff-summary {
        display: none;
        margin-top: 15px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }

      .diff-summary-title {
        font-weight: bold;
        margin-bottom: 8px;
        color: #495057;
      }

      #diff-summary-content {
        font-size: 0.9em;
        color: #666;
      }

      .diff-stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        padding: 2px 0;
      }

      .diff-stat-value {
        font-weight: 600;
        color: #495057;
      }

      .diff-stat-matched {
        color: #007bff;
      }

      .diff-stat-only-a {
        color: #28a745;
      }

      .diff-stat-only-b {
        color: #dc3545;
      }
      .diff-mode-description {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 8px;
      }

      .legend-description {
        font-size: 0.9em;
        color: #666;
      }

      /* â˜…â˜…â˜… å·®åˆ†æ¯”è¼ƒUIç”¨ã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²èª¿æ•´ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      .clipping-group {
        margin-bottom: 20px;
      }

      .clip-range-controls {
        margin-top: 10px;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
        animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          max-height: 0;
          padding-top: 0;
          padding-bottom: 0;
        }
        to {
          opacity: 1;
          max-height: 100px;
          padding-top: 12px;
          padding-bottom: 12px;
        }
      }

      .range-control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .range-control-group label {
        font-size: 0.85em;
        font-weight: 600;
        color: #495057;
        margin-bottom: 4px;
      }

      .range-slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .range-label {
        font-size: 0.75em;
        color: #6c757d;
        white-space: nowrap;
        min-width: 30px;
        text-align: center;
      }

      .clip-range-slider {
        flex: 1;
        height: 6px;
        background: #dee2e6;
        border-radius: 3px;
        outline: none;
        -webkit-appearance: none;
        appearance: none;
      }

      .clip-range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .clip-range-slider::-webkit-slider-thumb:hover {
        background: #0056b3;
        transform: scale(1.1);
      }

      .clip-range-slider::-moz-range-thumb {
        width: 18px;
        height: 18px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      .clip-range-slider::-moz-range-thumb:hover {
        background: #0056b3;
        transform: scale(1.1);
      }

      .range-value-display {
        text-align: center;
        font-size: 0.9em;
        font-weight: 600;
        color: #495057;
        background: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        min-width: 60px;
      }

      .clip-apply-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 0.85em;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-top: 5px;
      }

      .clip-apply-btn:hover {
        background: #218838;
      }

      .clip-apply-btn:active {
        background: #1e7e34;
      }

      .clear-clip-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 0.85em;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .clear-clip-btn:hover {
        background: #c82333;
      }

      .preview-clip-btn {
        background: #17a2b8;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 0.85em;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-left: 8px;
      }

      .preview-clip-btn:hover {
        background: #138496;
      }

      .clipping-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 10px;
      }

      /* ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°çŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
      .clipping-active {
        border-left: 4px solid #28a745;
        background: linear-gradient(135deg, #f8fff9 0%, #f1f9f1 100%);
      }

      .clipping-group.active .clip-apply-btn {
        background: #ffc107;
        color: #212529;
      }

      .clipping-group.active .clip-apply-btn:hover {
        background: #e0a800;
      }
      /* â˜…â˜…â˜… ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²èª¿æ•´ã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… CORSå•é¡Œå¯¾å¿œUI â˜…â˜…â˜… */
      .cors-warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-size: 0.9em;
        color: #856404;
        display: none;
      }

      .cors-warning .warning-title {
        font-weight: bold;
        margin-bottom: 8px;
        color: #d63031;
      }

      .cors-solutions {
        margin-top: 8px;
      }

      .cors-solutions ol {
        margin: 8px 0;
        padding-left: 20px;
      }

      .cors-solutions li {
        margin-bottom: 4px;
      }

      .cors-link {
        color: #007bff;
        text-decoration: underline;
        cursor: pointer;
      }
      /* â˜…â˜…â˜… CORSå•é¡Œå¯¾å¿œUIçµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… æ¯”è¼ƒã‚­ãƒ¼é¸æŠUI â˜…â˜…â˜… */
      .comparison-key-selector {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }

      .comparison-key-settings {
        margin-top: 12px;
      }

      .comparison-key-settings.hidden {
        display: none;
      }

      .settings-separator {
        margin: 15px 0;
        border: none;
        border-top: 1px solid #ddd;
      }

      .selector-header {
        margin-bottom: 10px;
      }

      .selector-label {
        font-weight: 600;
        font-size: 0.95em;
        color: #495057;
      }

      .selector-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .selector-option {
        background: white;
        padding: 8px 10px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .selector-option:hover {
        background: #f1f3f5;
        border-color: #adb5bd;
      }

      .radio-label {
        display: flex;
        align-items: flex-start;
        cursor: pointer;
        width: 100%;
      }

      .radio-label input[type="radio"] {
        margin-right: 8px;
        margin-top: 2px;
        flex-shrink: 0;
        cursor: pointer;
      }

      .radio-text {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .radio-text strong {
        font-size: 0.9em;
        color: #212529;
      }

      .radio-description {
        font-size: 0.8em;
        color: #6c757d;
        line-height: 1.4;
      }

      .selector-info {
        margin-top: 10px;
        padding-top: 8px;
        border-top: 1px solid #dee2e6;
      }

      .selector-info small {
        font-size: 0.75em;
        color: #6c757d;
        font-style: italic;
      }
      /* â˜…â˜…â˜… æ¯”è¼ƒã‚­ãƒ¼é¸æŠUIçµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… è¦ç´ è¡¨ç¤ºè¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ â˜…â˜…â˜… */
      /* è¦ç´ è¡¨ç¤ºè¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
      #element-settings-float {
        left: calc(50% - 160px); /* ä¸­å¤®å¯„ã› (min-widthã®åŠåˆ†) */
        min-width: 320px;
        max-width: 400px;
      }

      /* è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
      #display-settings-float {
        min-width: 400px;
        max-width: 500px;
      }

      /* è¡¨ç¤ºç¯„å›²è¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
      #clipping-settings-float {
        min-width: 400px;
        max-width: 500px;
      }

      .float-window-header {
        background-color: #4a5568;
        color: white;
        padding: 8px 12px;
        cursor: move;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 4px 4px 0 0;
        user-select: none;
      }

      .float-window-title {
        font-weight: bold;
        font-size: 0.95em;
      }

      .float-window-controls {
        display: flex;
        gap: 8px;
      }

      .float-window-btn {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.9em;
      }

      .float-window-btn:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .float-window-content {
        padding: 12px;
      }

      .float-window-content label {
        display: block;
        margin-bottom: 6px;
        font-size: 0.85em;
      }

      .float-window-content input[type="checkbox"] {
        margin-right: 5px;
      }

      .float-window-content hr {
        margin: 10px 0;
        border: none;
        border-top: 1px solid #ddd;
      }

      .margin-left-8 {
        margin-left: 8px;
      }

      /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
      #toggle-element-settings-btn,
      #toggle-display-settings-btn,
      #toggle-clipping-settings-btn,
      #toggle-component-info-btn,
      #toggle-element-tree-btn,
      #toggle-section-tree-btn {
        background-color: #4a5568;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        width: calc(100% - 10px);
        margin-top: 10px;
      }

      #toggle-element-settings-btn:hover,
      #toggle-display-settings-btn:hover,
      #toggle-clipping-settings-btn:hover,
      #toggle-component-info-btn:hover,
      #toggle-element-tree-btn:hover,
      #toggle-section-tree-btn:hover {
        background-color: #2d3748;
      }

      /* ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ¢ãƒ¼ãƒ‰é¸æŠ */
      .grouping-mode-select {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 3px;
        padding: 3px 6px;
        font-size: 0.75em;
        cursor: pointer;
        margin-right: 8px;
      }

      .grouping-mode-select:hover {
        background-color: #e9ecef;
      }
      /* â˜…â˜…â˜… ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å…±é€šã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      .floating-window {
        position: fixed;
        top: 80px;
        left: calc(50% - 200px); /* ä¸­å¤®å¯„ã› */
        background-color: rgba(240, 240, 240, 0.95);
        border: 1px solid #ccc;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        min-width: 400px;
        max-width: 600px;
        max-height: 80vh;
        z-index: 100;
        font-size: 0.9em;
        color: #333;
        display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
      }

      .floating-window.visible {
        display: block; /* visibleã‚¯ãƒ©ã‚¹ãŒä»˜ä¸ã•ã‚ŒãŸæ™‚ã«è¡¨ç¤º */
      }

      /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
      .floating-window:not(#component-info) .float-window-content {
        max-height: calc(80vh - 50px); /* ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ã‚’å¼•ã */
        overflow-y: auto;
        padding: 12px;
      }
      /* â˜…â˜…â˜… ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å…±é€šã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… ãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      #element-tree-float {
        min-width: 350px;
        max-width: 500px;
        left: 10px;
        top: 80px;
      }

      #element-tree-container {
        max-height: calc(80vh - 50px);
        overflow-y: auto;
        font-size: 0.9em;
      }

      .tree-node {
        user-select: none;
        margin: 2px 0;
      }

      .tree-node-header {
        display: flex;
        align-items: center;
        padding: 4px 6px;
        cursor: pointer;
        border-radius: 3px;
        transition: background-color 0.15s ease;
      }

      .tree-node-header:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      .tree-node-header.selected {
        background-color: rgba(0, 123, 255, 0.2);
        font-weight: 600;
      }

      .tree-toggle {
        width: 16px;
        height: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 4px;
        font-size: 0.7em;
        transition: transform 0.2s ease;
        cursor: pointer;
      }

      .tree-toggle.collapsed {
        transform: rotate(-90deg);
      }

      .tree-toggle.empty {
        visibility: hidden;
      }

      .tree-node-label {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .tree-node-icon {
        font-size: 1em;
      }

      .tree-node-text {
        font-size: 0.85em;
      }

      .tree-node-count {
        font-size: 0.75em;
        color: #666;
        margin-left: 4px;
      }

      .tree-node-children {
        margin-left: 20px;
        overflow: hidden;
        transition: max-height 0.3s ease, opacity 0.2s ease;
      }

      .tree-node-children.collapsed {
        max-height: 0;
        opacity: 0;
      }

      .tree-node-children.expanded {
        max-height: 10000px;
        opacity: 1;
      }

      .tree-leaf-node .tree-node-header {
        padding-left: 24px;
      }

      .tree-element-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
        flex: 1;
      }

      .tree-element-id {
        font-family: monospace;
        font-size: 0.8em;
        color: #495057;
      }

      .tree-element-guid {
        font-family: monospace;
        font-size: 0.65em;
        color: #868e96;
        font-style: italic;
        margin-top: 1px;
      }

      .tree-element-status {
        font-size: 0.7em;
        padding: 2px 4px;
        border-radius: 2px;
        margin-left: 6px;
        align-self: flex-start;
      }

      .tree-element-status.matched {
        background-color: #e7f3ff;
        color: #0066cc;
      }

      .tree-element-status.onlyA {
        background-color: #e8f5e9;
        color: #2e7d32;
      }

      .tree-element-status.onlyB {
        background-color: #ffebee;
        color: #c62828;
      }

      /* â˜…â˜…â˜… æ–­é¢ãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
      #section-tree-float {
        min-width: 380px;
        max-width: 550px;
        left: 380px; /* è¦ç´ ãƒ„ãƒªãƒ¼ã®å³å´ã«é…ç½® */
        top: 80px;
      }

      #section-tree-container {
        max-height: calc(80vh - 50px);
        overflow-y: auto;
        font-size: 0.9em;
      }

      /* æ–­é¢ã‚¿ã‚¤ãƒ—ã‚³ãƒ³ãƒ†ãƒŠ */
      .section-type-container {
        margin: 8px 0;
      }

      .section-type-header {
        display: flex;
        align-items: center;
        padding: 8px 10px;
        cursor: pointer;
        background-color: #f8f9fa;
        border-radius: 4px;
        border-left: 3px solid #6c757d;
        transition: background-color 0.15s ease;
      }

      .section-type-header:hover {
        background-color: #e9ecef;
      }

      .section-type-name {
        font-weight: 600;
        font-size: 0.95em;
        color: #343a40;
        flex: 1;
        margin-left: 6px;
      }

      .section-count {
        font-size: 0.75em;
        color: #6c757d;
        background-color: #dee2e6;
        padding: 2px 8px;
        border-radius: 10px;
      }

      .sections-container {
        margin-left: 12px;
        margin-top: 4px;
      }

      /* å€‹åˆ¥æ–­é¢ã‚¢ã‚¤ãƒ†ãƒ  */
      .section-item-container {
        margin: 6px 0;
      }

      .section-item-header {
        display: flex;
        align-items: center;
        padding: 6px 8px;
        cursor: pointer;
        background-color: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 3px;
        transition: all 0.15s ease;
      }

      .section-item-header:hover {
        background-color: #f1f3f5;
        border-color: #adb5bd;
      }

      .section-icon {
        margin-right: 6px;
        font-size: 1em;
      }

      .section-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
        margin-left: 4px;
      }

      .section-name {
        font-family: monospace;
        font-size: 0.85em;
        color: #212529;
        font-weight: 500;
      }

      .section-type-label {
        font-size: 0.7em;
        color: #6c757d;
        background-color: #f8f9fa;
        padding: 1px 5px;
        border-radius: 2px;
        align-self: flex-start;
      }

      .element-count {
        font-size: 0.75em;
        color: #495057;
        background-color: #e9ecef;
        padding: 2px 6px;
        border-radius: 8px;
      }

      .section-elements-container {
        margin-left: 24px;
        margin-top: 4px;
      }

      /* è¦ç´ ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ³ãƒ†ãƒŠï¼ˆéš/ç¬¦å·ã”ã¨ï¼‰ */
      .element-group-container {
        margin: 4px 0;
      }

      .element-group-header {
        display: flex;
        align-items: center;
        padding: 5px 8px;
        cursor: pointer;
        background-color: #f8f9fa;
        border-radius: 3px;
        transition: background-color 0.15s ease;
      }

      .element-group-header:hover {
        background-color: #e9ecef;
      }

      .group-name {
        font-size: 0.8em;
        color: #495057;
        font-weight: 500;
        margin-left: 4px;
        flex: 1;
      }

      .group-count {
        font-size: 0.7em;
        color: #6c757d;
        background-color: #dee2e6;
        padding: 1px 6px;
        border-radius: 8px;
      }

      .group-elements-container {
        margin-left: 16px;
        margin-top: 2px;
      }

      /* å€‹åˆ¥è¦ç´ ã‚¢ã‚¤ãƒ†ãƒ  */
      .section-tree-element-item {
        display: flex;
        align-items: flex-start;
        padding: 4px 6px 4px 8px;
        cursor: pointer;
        border-left: 2px solid transparent;
        border-radius: 2px;
        transition: all 0.15s ease;
      }

      .section-tree-element-item:hover {
        background-color: #f8f9fa;
        border-left-color: #228be6;
      }

      .section-toggle,
      .group-toggle {
        font-size: 0.8em;
        margin-right: 4px;
        transition: transform 0.2s ease;
      }

      .section-toggle.expanded,
      .group-toggle.expanded {
        transform: rotate(90deg);
      }

      /* â˜…â˜…â˜… æ–­é¢ãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */

      /* â˜…â˜…â˜… ãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«çµ‚äº† â˜…â˜…â˜… */
    </style>
  </head>
  <body>
    <div id="overlay">
      <!-- ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã¨æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="accordion-section">
        <div class="accordion-header" data-target="file-loading">
          <span>ğŸ“Š ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã¨æ¯”è¼ƒ</span>
          <span class="accordion-arrow">â–¼</span>
        </div>
        <div class="accordion-content" id="file-loading">
          <div class="diff-comparison-intro">
            <p>2ã¤ã®STBãƒ¢ãƒ‡ãƒ«ã‚’æ¯”è¼ƒã—ã¦å·®åˆ†ã‚’ç¢ºèªã—ã¾ã™</p>
          </div>
          <div class="file-input-wrapper">
            <label for="fileA"><strong>æ¯”è¼ƒå…ƒãƒ¢ãƒ‡ãƒ« (A)</strong></label>
            <button type="button" class="custom-file-btn" data-target="fileA">
              ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </button>
            <input type="file" id="fileA" accept=".stb,.xml" />
            <div class="selected-filename" id="fileA-name">
              é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“
            </div>
          </div>

          <div class="file-input-wrapper">
            <label for="fileB"><strong>æ¯”è¼ƒå…ˆãƒ¢ãƒ‡ãƒ« (B)</strong></label>
            <button type="button" class="custom-file-btn" data-target="fileB">
              ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </button>
            <input type="file" id="fileB" accept=".stb,.xml" />
            <div class="selected-filename" id="fileB-name">
              é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“
            </div>
          </div>

          <hr style="margin: 15px 0" />

          <button id="compareButton" class="btn-primary compare-button">
            ğŸ” STBèª­è¾¼
          </button>

          <!-- å·®åˆ†çµæœã‚µãƒãƒªãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
          <div id="diff-summary">
            <div class="diff-summary-title">ğŸ“ˆ å·®åˆ†ã‚µãƒãƒªãƒ¼</div>
            <div id="diff-summary-content">
              <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹å·®åˆ†çµ±è¨ˆ -->
            </div>
          </div>
        </div>
      </div>

      <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <button id="toggle-display-settings-btn">ğŸ¨ è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®š</button>

      <!-- è¡¨ç¤ºè¦ç´ è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <button id="toggle-element-settings-btn">ğŸ—ï¸ è¡¨ç¤ºè¦ç´ è¨­å®š</button>

      <!-- è¡¨ç¤ºç¯„å›²è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <button id="toggle-clipping-settings-btn">âœ‚ï¸ è¡¨ç¤ºç¯„å›²è¨­å®š</button>

      <!-- è¦ç´ æƒ…å ±ãƒ‘ãƒãƒ« -->
      <button id="toggle-component-info-btn">ğŸ“‹ è¦ç´ æƒ…å ±ãƒ‘ãƒãƒ«</button>

      <!-- è¦ç´ ãƒ„ãƒªãƒ¼è¡¨ç¤º -->
      <button id="toggle-element-tree-btn">ğŸŒ³ è¦ç´ ãƒ„ãƒªãƒ¼è¡¨ç¤º</button>

      <button id="toggle-section-tree-btn">ğŸ“ æ–­é¢ãƒ„ãƒªãƒ¼è¡¨ç¤º</button>

      <!-- é‡è¦åº¦è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="accordion-section">
        <div class="accordion-header" data-target="importance-settings">
          <span>ğŸ·ï¸ é‡è¦åº¦è¨­å®š</span>
          <span class="accordion-arrow">â–¼</span>
        </div>
        <div class="accordion-content collapsed" id="importance-settings">
          <button id="toggleImportanceBtn" class="btn btn-primary">
            ğŸ·ï¸ é‡è¦åº¦ãƒ‘ãƒãƒ«è¡¨ç¤º
          </button>
          <button
            onclick="window.toggleImportanceStatistics()"
            class="btn btn-primary"
          >
            ğŸ“Š çµ±è¨ˆè¡¨ç¤º
          </button>
          <button
            onclick="window.toggleBulkOperations()"
            class="btn btn-primary"
          >
            âš™ï¸ ä¸€æ‹¬æ“ä½œ
          </button>
        </div>
      </div>

      <!-- ãã®ä»–è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="accordion-section">
        <div class="accordion-header" data-target="other-settings">
          <span>âš™ï¸ ãã®ä»–è¨­å®š</span>
          <span class="accordion-arrow">â–¼</span>
        </div>
        <div class="accordion-content collapsed" id="other-settings">
          <button id="toggleLegendBtn" class="btn btn-primary">
            ğŸ” å·®åˆ†å‡¡ä¾‹ãƒ»æ“ä½œæ–¹æ³•ã‚’è¡¨ç¤º
          </button>

          <!-- CORSå•é¡Œå¯¾å¿œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div id="cors-warning" class="cors-warning">
            <div class="warning-title">âš ï¸ IFCå¤‰æ›APIæ¥ç¶šå•é¡Œ</div>
            <p>Google Cloud Runã®APIã‚µãƒ¼ãƒãƒ¼ã§CORSè¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚</p>
            <div class="cors-solutions">
              <strong>è§£æ±ºæ–¹æ³•:</strong>
              <ol>
                <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®CORSåˆ¶é™ã‚’ç„¡åŠ¹åŒ–ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰</li>
                <li>ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®ä½¿ç”¨</li>
                <li>
                  <span
                    class="cors-link"
                    onclick="window.open('https://cors-anywhere.herokuapp.com/corsdemo')"
                    >CORS Anywhere ãƒ‡ãƒ¢</span
                  >ã‚’æœ‰åŠ¹åŒ–
                </li>
                <li>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†è€…ã«CORSè¨­å®šã®ä¿®æ­£ã‚’ä¾é ¼</li>
              </ol>
              <button
                id="try-cors-proxy"
                class="btn btn-warning"
                onclick="window.enableCorsProxy()"
              >
                CORS ãƒ—ãƒ­ã‚­ã‚·ã‚’è©¦è¡Œ
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã®ã‚«ã‚¹ã‚¿ãƒ ãƒœã‚¿ãƒ³æŒ™å‹•ã‚’è¨­å®š
      (function () {
        function wire(targetId) {
          var btn = document.querySelector(
            '.custom-file-btn[data-target="' + targetId + '"]'
          );
          var input = document.getElementById(targetId);
          var nameEl = document.getElementById(targetId + "-name");
          if (!btn || !input || !nameEl) return;
          btn.addEventListener("click", function () {
            input.click();
          });
          input.addEventListener("change", function (e) {
            var f = input.files && input.files[0];
            nameEl.textContent = f ? f.name : "é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“";
          });
        }

        // å¯¾è±¡ã‚’ãƒ¯ã‚¤ãƒ¤ãƒ¼
        wire("fileA");
        wire("fileB");
      })();
    </script>

    <!-- ã“ã“ã«å‡¡ä¾‹ãƒ‘ãƒãƒ«ã®HTMLã‚’è¿½åŠ  -->
    <div id="legendPanel" class="panel legend-panel-hidden">
      <!-- åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º -->
      <div class="panel-header">ğŸ” å·®åˆ†æ¯”è¼ƒå‡¡ä¾‹</div>
      <div class="legend-content">
        <div class="legend-item">
          <span class="legend-color legend-color-matched"></span>
          <span><strong>ä¸€è‡´è¦ç´ </strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-onlya"></span>
          <span><strong>ãƒ¢ãƒ‡ãƒ«Aå°‚ç”¨</strong></span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-color-onlyb"></span>
          <span><strong>ãƒ¢ãƒ‡ãƒ«Bå°‚ç”¨</strong></span>
        </div>
        <hr />
        <div class="legend-item">
          <span class="legend-description">
            è‰²åˆ†ã‘ã§å·®åˆ†ã‚’ç›´æ„Ÿçš„ã«ç¢ºèªã§ãã¾ã™
          </span>
        </div>
        <hr />
        <div class="legend-item">
          <span><b>æ“ä½œæ–¹æ³•:</b></span>
        </div>
        <div class="legend-item">
          <span>å›è»¢: å·¦ãƒ‰ãƒ©ãƒƒã‚°</span>
        </div>
        <div class="legend-item">
          <span>å¹³è¡Œç§»å‹•: å³ãƒ‰ãƒ©ãƒƒã‚°</span>
        </div>
        <div class="legend-item">
          <span>ã‚ºãƒ¼ãƒ : ãƒ›ã‚¤ãƒ¼ãƒ«</span>
        </div>
      </div>
    </div>
    <!-- /å‡¡ä¾‹ãƒ‘ãƒãƒ« -->

    <!-- â˜…â˜…â˜… è¿½åŠ : è¦ç´ æƒ…å ±è¡¨ç¤ºãƒ‘ãƒãƒ« â˜…â˜…â˜… -->
    <div id="component-info" class="floating-window component-info-resizable">
      <div class="float-window-header" id="component-info-header">
        <span class="float-window-title">ğŸ“‹ è¦ç´ æƒ…å ±</span>
        <div class="float-window-controls">
          <button class="float-window-btn" id="close-component-info-btn">
            âœ•
          </button>
        </div>
      </div>

      <div class="float-window-content" id="component-info-content-wrapper">
        <!-- ç·¨é›†æ©Ÿèƒ½UI (æœ€å°åŒ–) -->
        <div
          id="editing-controls"
          style="font-size: 0.8em; opacity: 0.7; margin-bottom: 8px"
        >
          <button
            id="edit-mode-button"
            class="btn btn-sm"
            style="
              font-size: 0.7em;
              padding: 2px 6px;
              background: #f8f9fa;
              border: 1px solid #dee2e6;
              color: #6c757d;
            "
            onclick="window.toggleEditMode()"
            title="é«˜åº¦ãªç·¨é›†æ©Ÿèƒ½ï¼ˆé–‹ç™ºè€…å‘ã‘)"
          >
            ç·¨é›†
          </button>
          <span
            id="editing-summary"
            style="font-size: 0.7em; color: #6c757d; margin-left: 5px"
          >
            ä¿®æ­£: 0ä»¶
          </span>
        </div>
        <div id="element-info-content">è¦ç´ ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
      </div>
    </div>
    <!-- /è¦ç´ æƒ…å ±è¡¨ç¤ºãƒ‘ãƒãƒ« -->

    <canvas id="three-canvas"></canvas>

    <!-- é–‹ç™ºè€…å‘ã‘ãƒªãƒ³ã‚¯ (æœ¬ç•ªç’°å¢ƒã§ã¯å‰Šé™¤) -->
    <div
      id="dev-tools"
      style="
        position: fixed;
        bottom: 10px;
        right: 10px;
        z-index: 1000;
        display: none;
      "
    >
      <a
        href="test.html"
        style="
          background: #666;
          color: white;
          padding: 4px 8px;
          text-decoration: none;
          border-radius: 3px;
          font-size: 11px;
          opacity: 0.7;
        "
        title="é–‹ç™ºè€…å‘ã‘ãƒ†ã‚¹ãƒˆç’°å¢ƒ"
      >
        ğŸ§ª Tests
      </a>
    </div>

    <!-- ç’°å¢ƒè¨­å®šç®¡ç† -->
    <script type="module">
      import {
        getEnvironmentConfig,
        isFeatureEnabled,
        displayEnvironmentInfo,
      } from "./js/config/environment.js";

      // ç’°å¢ƒè¨­å®šã‚’éåŒæœŸã§åˆæœŸåŒ–
      async function initializeEnvironment() {
        try {
          window.envConfig = await getEnvironmentConfig();

          // é–‹ç™ºç’°å¢ƒã§ã®ã¿ãƒ†ã‚¹ãƒˆãƒªãƒ³ã‚¯ã¨ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
          if (window.envConfig.features.devTools) {
            document.getElementById("dev-tools").style.display = "block";
            await displayEnvironmentInfo();
          }

          // çµ±ä¸€ãƒ­ã‚¬ãƒ¼ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹å‰ã§ã‚‚å®‰å…¨ãªã‚ˆã†ã« try/catch
          try {
            window.AppLogger?.setLevel &&
              window.AppLogger.setLevel(window.envConfig?.logLevel || "warn");
          } catch (e) {}
          console.log("âœ… ç’°å¢ƒè¨­å®šåˆæœŸåŒ–å®Œäº†:", window.envConfig.environment);
        } catch (error) {
          console.error("âŒ ç’°å¢ƒè¨­å®šåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
          window.envConfig = {
            environment: "production",
            stb2ifc: {
              apiBaseUrl: "https://stb2ifc-api-e23mdd6kwq-an.a.run.app",
            },
            features: { devTools: false },
          };
        }
      }

      // CORS ãƒ—ãƒ­ã‚­ã‚·æœ‰åŠ¹åŒ–é–¢æ•°ï¼ˆç’°å¢ƒè¨­å®šã‚’ä½¿ç”¨ï¼‰
      window.enableCorsProxy = async function () {
        if (window.ifcConverter) {
          try {
            if (!window.envConfig) {
              window.envConfig = await getEnvironmentConfig();
            }

            const originalUrl = window.ifcConverter.apiBaseUrl;
            window.ifcConverter.apiBaseUrl =
              window.envConfig.corsProxy.proxyUrl +
              window.envConfig.stb2ifc.apiBaseUrl;

            alert(
              `CORS ãƒ—ãƒ­ã‚­ã‚·ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸã€‚\n\næ–°ã—ã„URL: ${window.ifcConverter.apiBaseUrl}\n\næ³¨æ„: ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯å®Ÿé¨“çš„ã§ã€æœ¬ç•ªä½¿ç”¨ã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚`
            );

            // è­¦å‘Šã‚’éè¡¨ç¤º
            if (window.ifcConverter.hideCorsWarning) {
              window.ifcConverter.hideCorsWarning();
            }
          } catch (error) {
            console.error("CORS ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚¨ãƒ©ãƒ¼:", error);
            alert("CORS ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          }
        }
      };

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«éåŒæœŸç‰ˆé–¢æ•°ã‚’å…¬é–‹
      window.isFeatureEnabled = isFeatureEnabled;
      window.getEnvironmentConfig = getEnvironmentConfig;

      // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆæœŸåŒ–
      initializeEnvironment();
    </script>

    <!-- â˜…â˜…â˜… ãƒ‘ã‚¹ã‚’ js/main.js ã«å¤‰æ›´ â˜…â˜…â˜… -->
    <script type="module" src="js/main.js"></script>

    <!-- é–‹ç™ºç”¨: æ–­é¢å·®ç•°è¨ºæ–­ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
    <script type="module" src="js/diagnostics/geometryInspector.js"></script>
    <script
      type="module"
      src="js/diagnostics/geometryMismatchAnalyzer.js"
    ></script>

    <!-- â˜…â˜…â˜… è¿½åŠ : selectComponentInfo.js ã® script ã‚¿ã‚°ã¯ä¸è¦ (main.js ã‹ã‚‰ import ã•ã‚Œã‚‹ãŸã‚) â˜…â˜…â˜… -->
    <!-- <script type="module" src="selectComponentInfo.js"></script> -->

    <!-- è¡¨ç¤ºè¦ç´ è¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="element-settings-float" class="floating-window">
      <div class="float-window-header" id="element-settings-header">
        <span class="float-window-title">ğŸ—ï¸ è¡¨ç¤ºè¦ç´ è¨­å®š</span>
        <div class="float-window-controls">
          <button class="float-window-btn" id="close-element-settings-btn">
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="elementSelector">
          <!-- ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
          <label><strong>ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰</strong></label>
          <div
            style="
              display: flex;
              gap: 4px;
              margin-top: 4px;
              margin-bottom: 10px;
            "
          >
            <button
              type="button"
              class="btn btn-sm camera-mode-btn active"
              data-mode="perspective"
              id="cameraPerspectiveBtn"
            >
              ğŸ”­ 3Dï¼ˆé€è¦–æŠ•å½±ï¼‰
            </button>
            <button
              type="button"
              class="btn btn-sm camera-mode-btn"
              data-mode="orthographic"
              id="cameraOrthographicBtn"
            >
              ğŸ“ 2Dï¼ˆå¹³è¡ŒæŠ•å½±ï¼‰
            </button>
          </div>
          <!-- Hidden radio buttons for compatibility -->
          <input
            type="radio"
            name="cameraMode"
            value="perspective"
            id="cameraPerspective"
            checked
            style="display: none"
          />
          <input
            type="radio"
            name="cameraMode"
            value="orthographic"
            id="cameraOrthographic"
            style="display: none"
          />

          <!-- ãƒ“ãƒ¥ãƒ¼æ–¹å‘é¸æŠï¼ˆ2Dãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
          <div
            id="viewDirectionPanel"
            style="display: none; margin-bottom: 10px"
          >
            <label><strong>ãƒ“ãƒ¥ãƒ¼æ–¹å‘</strong></label>
            <div
              style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px"
            >
              <button type="button" class="btn btn-sm" data-view="top">
                å¹³é¢å›³
              </button>
              <button type="button" class="btn btn-sm" data-view="front">
                æ­£é¢å›³
              </button>
              <button type="button" class="btn btn-sm" data-view="right">
                å³å´é¢å›³
              </button>
              <button type="button" class="btn btn-sm" data-view="left">
                å·¦å´é¢å›³
              </button>
              <button type="button" class="btn btn-sm" data-view="iso">
                ç­‰è§’å›³
              </button>
            </div>
          </div>

          <hr style="margin: 15px 0" />

          <label><strong>ãƒ¢ãƒ‡ãƒ«è¡¨ç¤º</strong></label>
          <label>
            <input
              type="checkbox"
              id="toggleModelA"
              name="modelVisibility"
              value="A"
              checked
            />
            ãƒ¢ãƒ‡ãƒ«Aã‚’è¡¨ç¤º
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              id="toggleModelB"
              name="modelVisibility"
              value="B"
              checked
            />
            ãƒ¢ãƒ‡ãƒ«Bã‚’è¡¨ç¤º
          </label>

          <hr style="margin: 15px 0" />

          <!-- ãƒ©ãƒ™ãƒ«è¡¨ç¤ºå†…å®¹è¨­å®š -->
          <label><strong>ãƒ©ãƒ™ãƒ«è¡¨ç¤ºå†…å®¹</strong></label>
          <select
            id="labelContentSelector"
            class="form-control"
            title="ãƒ©ãƒ™ãƒ«ã«è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’é¸æŠ"
            style="margin-bottom: 10px"
          >
            <option value="id">ã‚¿ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</option>
            <option value="name">ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åï¼ˆNameï¼‰</option>
            <option value="section">æ–­é¢åï¼ˆSectionï¼‰</option>
          </select>

          <hr style="margin: 15px 0" />

          <label><strong>æ¯”è¼ƒ/è¡¨ç¤ºã™ã‚‹è¦ç´ </strong></label>
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Node"
              id="toggleNodeView"
              checked
            />
            ç¯€ç‚¹ (Node)
          </label>
          <label for="toggleLabel-Node">
            <input
              type="checkbox"
              name="labelToggle"
              value="Node"
              id="toggleLabel-Node"
            />
            ID
          </label>
          <br />
          <label>
            <input type="checkbox" name="elements" value="Column" checked />
            æŸ± (Column)
          </label>
          <label for="toggleColumnView" class="margin-left-8">
            <input
              type="checkbox"
              id="toggleColumnView"
              name="columnViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Column" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Column"
              id="toggleLabel-Column"
            />
            ID
          </label>
          <br />
          <label>
            <input type="checkbox" name="elements" value="Girder" checked />
            å¤§æ¢ (Girder)
          </label>
          <label for="toggleGirderView" class="margin-left-8">
            <input
              type="checkbox"
              id="toggleGirderView"
              name="girderViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Girder" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Girder"
              id="toggleLabel-Girder"
            />
            ID
          </label>
          <br />
          <label>
            <input type="checkbox" name="elements" value="Beam" checked />
            å°æ¢ (Beam)
          </label>
          <label for="toggleBeam3DView" class="margin-left-8">
            <input
              type="checkbox"
              id="toggleBeam3DView"
              name="beam3DViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Beam" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Beam"
              id="toggleLabel-Beam"
            />
            ID
          </label>
          <br />

          <!-- é…ç½®åŸºæº–ç·šè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ -->
          <div class="placement-line-control">
            <label for="togglePlacementLines">
              <input type="checkbox" id="togglePlacementLines" checked />
              ç«‹ä½“è¡¨ç¤ºæ™‚ã®é…ç½®åŸºæº–ç·šã‚’è¡¨ç¤º
            </label>
          </div>

          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Brace"
              id="toggleBraceView"
              checked
            />
            ãƒ–ãƒ¬ãƒ¼ã‚¹ (Brace)
          </label>
          <label for="toggleBrace3DView" class="margin-left-8">
            <input
              type="checkbox"
              id="toggleBrace3DView"
              name="brace3DViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Brace" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Brace"
              id="toggleLabel-Brace"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Post"
              id="togglePostView"
              checked
            />
            é–“æŸ± (Post)
          </label>
          <label for="togglePost3DView" class="margin-left-8">
            <input
              type="checkbox"
              id="togglePost3DView"
              name="post3DViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Post" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Post"
              id="toggleLabel-Post"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Pile"
              id="togglePileView"
              checked
            />
            æ­ (Pile)
          </label>
          <label for="togglePile3DView" class="margin-left-8">
            <input
              type="checkbox"
              id="togglePile3DView"
              name="pile3DViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Pile" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Pile"
              id="toggleLabel-Pile"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Footing"
              id="toggleFootingView"
              checked
            />
            åŸºç¤ (Footing)
          </label>
          <label for="toggleFooting3DView" class="margin-left-8">
            <input
              type="checkbox"
              id="toggleFooting3DView"
              name="footing3DViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-Footing" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="Footing"
              id="toggleLabel-Footing"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="FoundationColumn"
              id="toggleFoundationColumnView"
              checked
            />
            åŸºç¤æŸ± (FoundationColumn)
          </label>
          <label for="toggleFoundationColumn3DView" class="margin-left-8">
            <input
              type="checkbox"
              id="toggleFoundationColumn3DView"
              name="foundationColumn3DViewMode"
            />
            ç«‹ä½“è¡¨ç¤º
          </label>
          <label for="toggleLabel-FoundationColumn" class="margin-left-8">
            <input
              type="checkbox"
              name="labelToggle"
              value="FoundationColumn"
              id="toggleLabel-FoundationColumn"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Slab"
              id="toggleSlabView"
              checked
            />
            ã‚¹ãƒ©ãƒ– (Slab)
          </label>
          <label for="toggleLabel-Slab">
            <input
              type="checkbox"
              name="labelToggle"
              value="Slab"
              id="toggleLabel-Slab"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Wall"
              id="toggleWallView"
              checked
            />
            å£ (Wall)
          </label>
          <label for="toggleLabel-Wall">
            <input
              type="checkbox"
              name="labelToggle"
              value="Wall"
              id="toggleLabel-Wall"
            />
            ID
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Axis"
              id="toggleAxisView"
              checked
            />
            é€šã‚ŠèŠ¯ (Axis)
          </label>
          <label for="toggleLabel-Axis">
            <input
              type="checkbox"
              name="labelToggle"
              value="Axis"
              id="toggleLabel-Axis"
              checked
            />
            åç§°
          </label>
          <br />
          <label>
            <input
              type="checkbox"
              name="elements"
              value="Story"
              id="toggleStoryView"
              checked
            />
            éš (Story)
          </label>
          <label for="toggleLabel-Story">
            <input
              type="checkbox"
              name="labelToggle"
              value="Story"
              id="toggleLabel-Story"
              checked
            />
            åç§°/é«˜ã•
          </label>
        </div>
      </div>
    </div>

    <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="display-settings-float" class="floating-window">
      <div class="float-window-header" id="display-settings-header">
        <span class="float-window-title">ğŸ¨ è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰è¨­å®š</span>
        <div class="float-window-controls">
          <button class="float-window-btn" id="close-display-settings-btn">
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <!-- è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰é¸æŠUI -->
        <div id="color-mode-controls">
          <label><strong>è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰</strong></label>
          <div class="diff-mode-description">
            å·®åˆ†ç¢ºèªã«ã¯ã€Œå·®åˆ†è¡¨ç¤ºã€ã‚’æ¨å¥¨ã—ã¾ã™
          </div>
          <select
            id="colorModeSelector"
            class="form-control"
            title="è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ"
          >
            <option value="diff">ğŸ” å·®åˆ†è¡¨ç¤ºï¼ˆæ¨å¥¨ï¼‰</option>
            <option value="element">ğŸ—ï¸ éƒ¨æåˆ¥è‰²ä»˜ã‘</option>
            <option value="schema">âš ï¸ ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è¡¨ç¤º</option>
            <option value="importance">ğŸ·ï¸ é‡è¦åº¦åˆ¥è‰²ä»˜ã‘</option>
          </select>

          <div id="comparison-key-settings" class="comparison-key-settings">
            <hr class="settings-separator" />
            <div id="comparison-key-selector-container">
              <!-- comparisonKeySelector.jsã«ã‚ˆã£ã¦å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
          </div>

          <!-- è‰²ä»˜ã‘ãƒ¢ãƒ¼ãƒ‰çŠ¶æ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
          <div id="color-mode-status" class="color-mode-status hidden">
            <span id="color-mode-status-text"></span>
          </div>

          <!-- éƒ¨æåˆ¥è‰²ä»˜ã‘è¨­å®š -->
          <div id="element-color-settings" class="element-color-settings">
            <label class="color-setting-label">éƒ¨æè‰²è¨­å®š:</label>
            <div class="color-setting-help">
              â€» è‰²ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å„éƒ¨æã®è¡¨ç¤ºè‰²ã‚’å¤‰æ›´ã§ãã¾ã™
            </div>
            <div class="color-legend-container" id="element-color-controls">
              <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
          </div>

          <!-- ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è‰²è¨­å®š -->
          <div id="schema-color-settings" class="schema-color-settings">
            <label class="color-setting-label">ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼è‰²è¨­å®š:</label>
            <div class="color-setting-help">
              â€» ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã®çµæœã«å¿œã˜ã¦è¦ç´ ã«è‰²ä»˜ã‘ã—ã¾ã™
            </div>
            <div class="color-legend-container">
              <div class="legend-item">
                <input
                  type="color"
                  id="schema-valid-color"
                  value="#00aaff"
                  class="legend-color-box"
                  title="æ­£å¸¸è¦ç´ ã®è‰²ã‚’å¤‰æ›´"
                />
                <span class="legend-label">æ­£å¸¸è¦ç´ </span>
                <span
                  class="color-preview"
                  id="schema-valid-preview"
                  title="ç¾åœ¨ã®è‰²: #00aaff"
                ></span>
              </div>
              <div class="legend-item">
                <input
                  type="color"
                  id="schema-error-color"
                  value="#ff0000"
                  class="legend-color-box"
                  title="ã‚¨ãƒ©ãƒ¼è¦ç´ ã®è‰²ã‚’å¤‰æ›´"
                />
                <span class="legend-label">ã‚¨ãƒ©ãƒ¼è¦ç´ </span>
                <span
                  class="color-preview"
                  id="schema-error-preview"
                  title="ç¾åœ¨ã®è‰²: #ff0000"
                ></span>
              </div>
            </div>
          </div>

          <!-- é‡è¦åº¦è‰²è¨­å®š -->
          <div id="importance-color-settings" class="importance-color-settings">
            <label class="color-setting-label">é‡è¦åº¦è‰²è¨­å®š:</label>
            <div class="color-setting-help">
              â€» å„é‡è¦åº¦ãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤ºè‰²ã‚’å¤‰æ›´ã§ãã¾ã™
            </div>
            <div class="color-legend-container" id="importance-color-controls">
              <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¡¨ç¤ºç¯„å›²è¨­å®šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="clipping-settings-float" class="floating-window">
      <div class="float-window-header" id="clipping-settings-header">
        <span class="float-window-title">âœ‚ï¸ è¡¨ç¤ºç¯„å›²è¨­å®š</span>
        <div class="float-window-controls">
          <button class="float-window-btn" id="close-clipping-settings-btn">
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <!-- éšã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è¨­å®š -->
        <div class="clipping-group">
          <label for="storySelector"><strong>éšã®è¡¨ç¤ºåˆ¶é™</strong></label>
          <select id="storySelector"></select>
          <button id="applyStoryClipButton" class="clip-apply-btn">
            ã“ã®éšã§ã‚¯ãƒªãƒƒãƒ—
          </button>

          <!-- éšã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²èª¿æ•´ -->
          <div
            id="storyClipControls"
            class="clip-range-controls"
            style="display: none"
          >
            <div class="range-control-group">
              <label for="storyClipRange">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="storyClipRange"
                  min="500"
                  max="5000"
                  value="1000"
                  step="100"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">
                Â±<span id="storyRangeValue">1.0</span>m
              </div>
            </div>
          </div>
        </div>

        <hr style="margin: 15px 0" />

        <!-- Xè»¸ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è¨­å®š -->
        <div class="clipping-group">
          <label for="xAxisSelector"><strong>Xè»¸é¸æŠ</strong></label>
          <select id="xAxisSelector"></select>
          <button id="applyXAxisClipButton" class="clip-apply-btn">
            Xè»¸ã§ã‚¯ãƒªãƒƒãƒ—
          </button>

          <!-- Xè»¸ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²èª¿æ•´ -->
          <div
            id="xAxisClipControls"
            class="clip-range-controls"
            style="display: none"
          >
            <div class="range-control-group">
              <label for="xAxisClipRange">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="xAxisClipRange"
                  min="500"
                  max="10000"
                  value="2000"
                  step="250"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">
                Â±<span id="xAxisRangeValue">2.0</span>m
              </div>
            </div>
          </div>
        </div>

        <hr style="margin: 15px 0" />

        <!-- Yè»¸ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è¨­å®š -->
        <div class="clipping-group">
          <label for="yAxisSelector"><strong>Yè»¸é¸æŠ</strong></label>
          <select id="yAxisSelector"></select>
          <button id="applyYAxisClipButton" class="clip-apply-btn">
            Yè»¸ã§ã‚¯ãƒªãƒƒãƒ—
          </button>

          <!-- Yè»¸ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²èª¿æ•´ -->
          <div
            id="yAxisClipControls"
            class="clip-range-controls"
            style="display: none"
          >
            <div class="range-control-group">
              <label for="yAxisClipRange">ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="yAxisClipRange"
                  min="500"
                  max="10000"
                  value="2000"
                  step="250"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">
                Â±<span id="yAxisRangeValue">2.0</span>m
              </div>
            </div>
          </div>
        </div>

        <hr style="margin: 15px 0" />

        <!-- 2Då¥¥è¡Œãã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è¨­å®š -->
        <div
          class="clipping-group"
          id="depth2DClippingGroup"
          style="display: none"
        >
          <label><strong>2Dè¡¨ç¤ºå¥¥è¡Œãç¯„å›²</strong></label>
          <p style="font-size: 0.85em; color: #666; margin: 5px 0">
            2Dãƒ“ãƒ¥ãƒ¼æ™‚ã«è¡¨ç¤ºã™ã‚‹å¥¥è¡Œãï¼ˆZè»¸ï¼‰ç¯„å›²ã‚’èª¿æ•´ã—ã¾ã™
          </p>

          <!-- å¥¥è¡Œãã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ç¯„å›²èª¿æ•´ -->
          <div class="clip-range-controls" style="display: block">
            <div class="range-control-group">
              <label for="depth2DClipRange">è¡¨ç¤ºå¥¥è¡Œãç¯„å›²:</label>
              <div class="range-slider-container">
                <span class="range-label">ç‹­ã„</span>
                <input
                  type="range"
                  id="depth2DClipRange"
                  min="1000"
                  max="20000"
                  value="5000"
                  step="500"
                  class="clip-range-slider"
                />
                <span class="range-label">åºƒã„</span>
              </div>
              <div class="range-value-display">
                Â±<span id="depth2DRangeValue">5.0</span>m
              </div>
            </div>

            <div class="range-control-group" style="margin-top: 10px">
              <label for="depth2DClipCenter">å¥¥è¡Œãä¸­å¿ƒä½ç½®:</label>
              <div class="range-slider-container">
                <span class="range-label" style="min-width: 50px">ä¸‹</span>
                <input
                  type="range"
                  id="depth2DClipCenter"
                  min="-50000"
                  max="50000"
                  value="0"
                  step="500"
                  class="clip-range-slider"
                />
                <span class="range-label" style="min-width: 50px">ä¸Š</span>
              </div>
              <div class="range-value-display">
                <span id="depth2DCenterValue">0.0</span>m
              </div>
            </div>

            <button
              id="applyDepth2DClipButton"
              class="clip-apply-btn"
              style="width: 100%; margin-top: 10px"
            >
              2Då¥¥è¡Œãã‚¯ãƒªãƒƒãƒ—ã‚’é©ç”¨
            </button>
          </div>
        </div>

        <hr style="margin: 15px 0" />

        <!-- ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°åˆ¶å¾¡ãƒœã‚¿ãƒ³ -->
        <div class="clipping-controls">
          <button id="clearClipButton" class="clear-clip-btn">
            ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è§£é™¤
          </button>
          <button
            id="previewClipButton"
            class="preview-clip-btn"
            style="display: none"
          >
            ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
          </button>
        </div>
      </div>
    </div>

    <!-- è¦ç´ ãƒ„ãƒªãƒ¼è¡¨ç¤ºãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="element-tree-float" class="floating-window">
      <div class="float-window-header" id="element-tree-header">
        <span class="float-window-title">ğŸŒ³ è¦ç´ ãƒ„ãƒªãƒ¼</span>
        <div class="float-window-controls">
          <button class="float-window-btn" id="close-element-tree-btn">
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="element-tree-container">
          <!-- ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
          <div style="padding: 10px; text-align: center; color: #666">
            ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„
          </div>
        </div>
      </div>
    </div>

    <!-- æ–­é¢ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="section-tree-float" class="floating-window">
      <div class="float-window-header" id="section-tree-header">
        <span class="float-window-title">ğŸ“ æ–­é¢ãƒ„ãƒªãƒ¼</span>
        <div class="float-window-controls">
          <!-- ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
          <select
            id="section-grouping-mode"
            class="grouping-mode-select"
            title="ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ¢ãƒ¼ãƒ‰"
          >
            <option value="floor">éšã”ã¨</option>
            <option value="code">ç¬¦å·ã”ã¨</option>
          </select>
          <button class="float-window-btn" id="close-section-tree-btn">
            âœ•
          </button>
        </div>
      </div>
      <div class="float-window-content">
        <div id="section-tree-container">
          <!-- æ–­é¢ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
          <div style="padding: 10px; text-align: center; color: #666">
            ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
